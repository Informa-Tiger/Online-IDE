export class Type {
    constructor() {
        this.onlyFirstPass = false;
        this.usagePositions = new Map();
        this.documentation = "";
    }
    toTokenType() {
        return null;
    }
    ;
    clearUsagePositions() {
        this.usagePositions = new Map();
    }
}
export class PrimitiveType extends Type {
    constructor() {
        super(...arguments);
        this.initialValue = null;
        this.description = "";
        // public unboxFrom(value: Value, type: Type): Value {
        //     if ((type["unboxableAs"] || []).includes(this)){
        //         if (value.value != null) return {
        //             value: value.value,
        //             type: value.type
        //         };
        //         else {
        //             throw Error("null kann nicht in einen primitiven " + this.identifier + " umgewandelt werden.");
        //         }
        //     }
        //     return null;
        // }
    }
    equals(type) {
        return type == this;
    }
    getResultType(operation, secondOperandType) {
        let opTypeMap = this.operationTable[operation];
        if (opTypeMap == null) {
            return null; // Operation not possible
        }
        if (secondOperandType != null) {
            return opTypeMap[secondOperandType.identifier];
        }
        return opTypeMap["none"];
    }
    canCastTo(type) {
        return this.canCastToMap[type.identifier] != null;
    }
    getCastInformation(type) {
        return this.canCastToMap[type.identifier];
    }
    allowsNull() { return false; }
}
export class Attribute {
    constructor(name, type, updateValue, isStatic, visibility, isFinal, documentation) {
        this.onlyFirstPass = false;
        this.identifier = name;
        this.type = type;
        this.updateValue = updateValue;
        this.isStatic = isStatic;
        this.visibility = visibility;
        this.isFinal = isFinal;
        this.usagePositions = new Map();
        this.documentation = documentation;
    }
}
export class Method extends Type {
    constructor(name, parameterlist, returnType, invokeOrAST, isAbstract, isStatic, documentation, isConstructor = false) {
        super();
        this.onlyFirstPass = false;
        this.isConstructor = false;
        this.isVirtual = false; // true, if child class has method with same signature
        this.reserveStackForLocalVariables = 0;
        this.genericTypeMap = null;
        this.identifier = name;
        this.parameterlist = parameterlist;
        this.returnType = returnType;
        this.isAbstract = isAbstract;
        this.isStatic = isStatic;
        this.visibility = 0;
        this.documentation = documentation;
        this.isConstructor = isConstructor;
        if (invokeOrAST != null) {
            if (typeof invokeOrAST == "function") {
                this.invoke = invokeOrAST;
            }
            else {
                this.program = invokeOrAST;
                invokeOrAST.method = this;
            }
        }
        this.signature = name + parameterlist.id;
        for (let p of parameterlist.parameters) {
            if (p["isTypeVariable"] == true) {
                this.hasGenericTypes = true;
                break;
            }
        }
        this.hasGenericTypes = this.hasGenericTypes || (this.returnType != null && this.returnType["isTypeVariable"] == true);
    }
    implements(m) {
        if (this.identifier != m.identifier)
            return false;
        if (this.returnType == null || this.returnType.identifier == "void") {
            if (m.returnType != null && m.returnType.identifier != "void")
                return false;
        }
        else {
            if (m.returnType instanceof PrimitiveType) {
                if (m.returnType != this.returnType) {
                    return false;
                }
            }
            else if (!this.returnType.canCastTo(m.returnType)) {
                return false;
            }
        }
        if (this.parameterlist.parameters.length != m.parameterlist.parameters.length)
            return false;
        for (let i = 0; i < this.parameterlist.parameters.length; i++) {
            let myParameter = this.parameterlist.parameters[i];
            let mParameter = m.parameterlist.parameters[i];
            if (mParameter.type instanceof PrimitiveType) {
                if (mParameter.type != myParameter.type) {
                    return false;
                }
            }
            else if (!mParameter.type.canCastTo(myParameter.type))
                return false;
        }
        return true;
    }
    hasEllipsis() {
        if (this.parameterlist.parameters.length == 0)
            return false;
        return this.parameterlist.parameters[this.parameterlist.parameters.length - 1].isEllipsis;
    }
    getParameterType(index) {
        return this.parameterlist.parameters[index].type;
    }
    getParameter(index) {
        return this.parameterlist.parameters[index];
    }
    getReturnType() {
        return this.returnType;
    }
    getParameterCount() {
        return this.parameterlist.parameters.length;
    }
    getParameterList() {
        return this.parameterlist;
    }
    getSignatureWithReturnParameter() {
        if (this.returnType != null) {
            return this.returnType.identifier + " " + this.signature;
        }
        else {
            return "void " + this.signature;
        }
    }
    getCompletionLabel() {
        let label = "";
        if (this.returnType != null && this.returnType.identifier != "void") {
            label += getTypeIdentifier(this.returnType) + " ";
        }
        label += this.identifier + "(";
        let parameters = this.parameterlist.parameters;
        for (let i = 0; i < parameters.length; i++) {
            let p = parameters[i];
            if (p.isEllipsis) {
                let arrayType = p.type;
                label += getTypeIdentifier(arrayType.arrayOfType) + "... " + p.identifier;
            }
            else {
                label += getTypeIdentifier(p.type) + " " + p.identifier;
            }
            if (i < parameters.length - 1) {
                label += ", ";
            }
        }
        label += ")";
        return label;
    }
    getCompletionSnippet(leftBracketAlreadyThere) {
        if (leftBracketAlreadyThere)
            return this.identifier + "($0";
        let snippet = "";
        snippet += this.identifier + "(";
        let isVoidReturn = this.returnType == null || this.returnType.identifier == "void";
        let isVoidReturnDelta = isVoidReturn ? 1 : 0;
        let parameters = this.parameterlist.parameters;
        for (let i = 0; i < parameters.length; i++) {
            let p = parameters[i];
            snippet += "${" + ((i + 1) % (parameters.length + isVoidReturnDelta)) + ":" + p.identifier + "}";
            if (i < parameters.length - 1) {
                snippet += ", ";
            }
        }
        snippet += ")";
        if (this.returnType == null || this.returnType.identifier == "void") {
            snippet += ";$0";
        }
        return snippet;
    }
    debugOutput(value) {
        return "";
    }
    equals(type) {
        return type == this;
    }
    getResultType(operation, secondOperandType) {
        return null;
    }
    compute(operation, firstOperand, secondOperand) {
        return null;
    }
    canCastTo(type) {
        return false;
    }
    castTo(value, type) { return value; }
}
export class Parameterlist {
    constructor(parameters) {
        this.parameters = parameters;
        this.computeId();
    }
    computeId() {
        this.id = "(";
        let i = 0;
        while (i < this.parameters.length) {
            this.id += this.parameters[i].type.identifier;
            if (i < this.parameters.length - 1) {
                this.id += ", ";
            }
            i++;
        }
        this.id += ")";
    }
}
export function getTypeIdentifier(type) {
    var _a, _b;
    if (type["typeVariables"]) {
        if (type["typeVariables"].length > 0) {
            let s = (type["isTypeVariable"] ? (type.identifier + " extends " + ((_a = type["isGenericVariantFrom"]) === null || _a === void 0 ? void 0 : _a.identifier)) : type.identifier)
                + "<";
            s += type["typeVariables"].map(tv => getTypeIdentifier(tv.type)).join(", ");
            return s + ">";
        }
    }
    return type["isTypeVariable"] ? (type.identifier + " extends " + ((_b = type["isGenericVariantFrom"]) === null || _b === void 0 ? void 0 : _b.identifier)) : type.identifier;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHlwZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2xpZW50L2NvbXBpbGVyL3R5cGVzL1R5cGVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQW9CQSxNQUFNLE9BQWdCLElBQUk7SUFVdEI7UUFSTyxrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUV0QixtQkFBYyxHQUFtQixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBSTNDLGtCQUFhLEdBQVcsRUFBRSxDQUFDO0lBR2xDLENBQUM7SUFZTSxXQUFXO1FBQ2QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUFBLENBQUM7SUFJRixtQkFBbUI7UUFDZixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7SUFDcEMsQ0FBQztDQUVKO0FBRUQsTUFBTSxPQUFnQixhQUFjLFNBQVEsSUFBSTtJQUFoRDs7UUFFVyxpQkFBWSxHQUFRLElBQUksQ0FBQztRQUV6QixnQkFBVyxHQUFXLEVBQUUsQ0FBQztRQW9DaEMsc0RBQXNEO1FBQ3RELHVEQUF1RDtRQUN2RCw0Q0FBNEM7UUFDNUMsa0NBQWtDO1FBQ2xDLCtCQUErQjtRQUMvQixhQUFhO1FBQ2IsaUJBQWlCO1FBQ2pCLDhHQUE4RztRQUM5RyxZQUFZO1FBQ1osUUFBUTtRQUNSLG1CQUFtQjtRQUNuQixJQUFJO0lBRVIsQ0FBQztJQTNDVSxNQUFNLENBQUMsSUFBVTtRQUNwQixPQUFPLElBQUksSUFBSSxJQUFJLENBQUM7SUFDeEIsQ0FBQztJQUVNLGFBQWEsQ0FBQyxTQUFvQixFQUFFLGlCQUF3QjtRQUUvRCxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRS9DLElBQUksU0FBUyxJQUFJLElBQUksRUFBRTtZQUNuQixPQUFPLElBQUksQ0FBQyxDQUFDLHlCQUF5QjtTQUN6QztRQUVELElBQUksaUJBQWlCLElBQUksSUFBSSxFQUFFO1lBQzNCLE9BQU8sU0FB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UUFDRCxJQUFJLENBQUMsRUFBRSxJQUFJLEdBQUcsQ0FBQztJQUNuQixDQUFDO0NBQ0o7QUEwQkQsTUFBTSxVQUFVLGlCQUFpQixDQUFDLElBQVU7O0lBQ3hDLElBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFDO1FBQ3JCLElBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUM7WUFDaEMsSUFBSSxDQUFDLEdBQVcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLFdBQVcsSUFBRyxNQUFBLElBQUksQ0FBQyxzQkFBc0IsQ0FBQywwQ0FBRSxVQUFVLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO2tCQUNySSxHQUFHLENBQUM7WUFDSCxDQUFDLElBQUksSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMvRSxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUM7U0FDbEI7S0FDSjtJQUVELE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxXQUFXLElBQUcsTUFBQSxJQUFJLENBQUMsc0JBQXNCLENBQUMsMENBQUUsVUFBVSxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztBQUNqSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUnVudGltZU9iamVjdCB9IGZyb20gXCIuLi8uLi9pbnRlcnByZXRlci9SdW50aW1lT2JqZWN0LmpzXCI7XHJcbmltcG9ydCB7IFRleHRQb3NpdGlvbiwgVG9rZW5UeXBlIH0gZnJvbSBcIi4uL2xleGVyL1Rva2VuLmpzXCI7XHJcbmltcG9ydCB7IE1vZHVsZSB9IGZyb20gXCIuLi9wYXJzZXIvTW9kdWxlLmpzXCI7XHJcbmltcG9ydCB7IFByb2dyYW0gfSBmcm9tIFwiLi4vcGFyc2VyL1Byb2dyYW0uanNcIjtcclxuaW1wb3J0IHsgQXJyYXlUeXBlIH0gZnJvbSBcIi4vQXJyYXkuanNcIjtcclxuaW1wb3J0IHsgVmlzaWJpbGl0eSwgVHlwZVZhcmlhYmxlIH0gZnJvbSBcIi4vQ2xhc3MuanNcIjtcclxuXHJcbmV4cG9ydCB0eXBlIFVzYWdlUG9zaXRpb25zID0gTWFwPE1vZHVsZSwgVGV4dFBvc2l0aW9uW10+O1xyXG5cclxuZXhwb3J0IHR5cGUgVGV4dFBvc2l0aW9uV2l0aE1vZHVsZSA9IHtcclxuICAgIG1vZHVsZTogTW9kdWxlLFxyXG4gICAgcG9zaXRpb246IFRleHRQb3NpdGlvbixcclxuICAgIG1vbmFjb01vZGVsPzogbW9uYWNvLmVkaXRvci5JVGV4dE1vZGVsXHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIENhc3RJbmZvcm1hdGlvbiA9IHtcclxuICAgIGF1dG9tYXRpYzogYm9vbGVhbixcclxuICAgIG5lZWRzU3RhdGVtZW50OiBib29sZWFuXHJcbn1cclxuXHJcbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBUeXBlIHtcclxuXHJcbiAgICBwdWJsaWMgb25seUZpcnN0UGFzcyA9IGZhbHNlO1xyXG5cclxuICAgIHB1YmxpYyB1c2FnZVBvc2l0aW9uczogVXNhZ2VQb3NpdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICBwdWJsaWMgZGVjbGFyYXRpb246IFRleHRQb3NpdGlvbldpdGhNb2R1bGU7XHJcblxyXG4gICAgcHVibGljIGlkZW50aWZpZXI6IHN0cmluZztcclxuICAgIHB1YmxpYyBkb2N1bWVudGF0aW9uOiBzdHJpbmcgPSBcIlwiO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBnZXRSZXN1bHRUeXBlKG9wZXJhdGlvbjogVG9rZW5UeXBlLCBzZWNvbmRPcGVyYW5kVHlwZT86IFR5cGUpOiBUeXBlO1xyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBjb21wdXRlKG9wZXJhdGlvbjogVG9rZW5UeXBlLCBmaXJzdE9wZXJhbmQ6IFZhbHVlLCBzZWNvbmRPcGVyYW5kPzogVmFsdWUpOiBhbnk7XHJcblxyXG4gICAgcHVibGljIGFic3RyYWN0IGNhbkNhc3RUbyh0eXBlOiBUeXBlKTogYm9vbGVhbjtcclxuXHJcbiAgICBwdWJsaWMgYWJzdHJhY3QgY2FzdFRvKHZhbHVlOiBWYWx1ZSwgdHlwZTogVHlwZSk6IFZhbHVlO1xyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBlcXVhbHModHlwZTogVHlwZSk6IGJvb2xlYW47XHJcblxyXG4gICAgcHVibGljIHRvVG9rZW5UeXBlKCk6IFRva2VuVHlwZSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIHB1YmxpYyBhYnN0cmFjdCBkZWJ1Z091dHB1dCh2YWx1ZTogVmFsdWUsIG1heExlbmd0aD86IG51bWJlcik6IHN0cmluZztcclxuXHJcbiAgICBjbGVhclVzYWdlUG9zaXRpb25zKCkge1xyXG4gICAgICAgIHRoaXMudXNhZ2VQb3NpdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUHJpbWl0aXZlVHlwZSBleHRlbmRzIFR5cGUge1xyXG5cclxuICAgIHB1YmxpYyBpbml0aWFsVmFsdWU6IGFueSA9IG51bGw7XHJcblxyXG4gICAgcHVibGljIGRlc2NyaXB0aW9uOiBzdHJpbmcgPSBcIlwiO1xyXG5cclxuICAgIHByb3RlY3RlZCBvcGVyYXRpb25UYWJsZTogeyBbb3BlcmF0aW9uOiBudW1iZXJdOiB7IFt0eXBlbmFtZTogc3RyaW5nXTogVHlwZSB9IH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgY2FuQ2FzdFRvTWFwOiB7IFt0eXBlOiBzdHJpbmddOiBDYXN0SW5mb3JtYXRpb24gfTtcclxuXHJcbiAgICBwdWJsaWMgZXF1YWxzKHR5cGU6IFR5cGUpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdHlwZSA9PSB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZXN1bHRUeXBlKG9wZXJhdGlvbjogVG9rZW5UeXBlLCBzZWNvbmRPcGVyYW5kVHlwZT86IFR5cGUpOiBUeXBlIHtcclxuXHJcbiAgICAgICAgbGV0IG9wVHlwZU1hcCA9IHRoaXMub3BlcmF0aW9uVGFibGVbb3BlcmF0aW9uXTtcclxuXHJcbiAgICAgICAgaWYgKG9wVHlwZU1hcCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsOyAvLyBPcGVyYXRpb24gbm90IHBvc3NpYmxlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2Vjb25kT3BlcmFuZFR5cGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gb3BUeXBlTWFwW3NlY29uZE9wZXJhbmRUeXBlLmlkZW50aWZpZXJdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG9wVHlwZU1hcFtcIm5vbmVcIl07XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjYW5DYXN0VG8odHlwZTogVHlwZSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhbkNhc3RUb01hcFt0eXBlLmlkZW50aWZpZXJdICE9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldENhc3RJbmZvcm1hdGlvbih0eXBlOiBUeXBlKTogQ2FzdEluZm9ybWF0aW9uIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYW5DYXN0VG9NYXBbdHlwZS5pZGVudGlmaWVyXTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWxsb3dzTnVsbCgpOiBib29sZWFuIHsgcmV0dXJuIGZhbHNlOyB9XHJcblxyXG4gICAgLy8gcHVibGljIHVuYm94RnJvbSh2YWx1ZTogVmFsdWUsIHR5cGU6IFR5cGUpOiBWYWx1ZSB7XHJcbiAgICAvLyAgICAgaWYgKCh0eXBlW1widW5ib3hhYmxlQXNcIl0gfHwgW10pLmluY2x1ZGVzKHRoaXMpKXtcclxuICAgIC8vICAgICAgICAgaWYgKHZhbHVlLnZhbHVlICE9IG51bGwpIHJldHVybiB7XHJcbiAgICAvLyAgICAgICAgICAgICB2YWx1ZTogdmFsdWUudmFsdWUsXHJcbiAgICAvLyAgICAgICAgICAgICB0eXBlOiB2YWx1ZS50eXBlXHJcbiAgICAvLyAgICAgICAgIH07XHJcbiAgICAvLyAgICAgICAgIGVsc2Uge1xyXG4gICAgLy8gICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJudWxsIGthbm4gbmljaHQgaW4gZWluZW4gcHJpbWl0aXZlbiBcIiArIHRoaXMuaWRlbnRpZmllciArIFwiIHVtZ2V3YW5kZWx0IHdlcmRlbi5cIik7XHJcbiAgICAvLyAgICAgICAgIH1cclxuICAgIC8vICAgICB9XHJcbiAgICAvLyAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAvLyB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQXR0cmlidXRlIHtcclxuXHJcbiAgICBvbmx5Rmlyc3RQYXNzOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgaWRlbnRpZmllcjogc3RyaW5nO1xyXG5cclxuICAgIGluZGV4OiBudW1iZXI7XHJcblxyXG4gICAgdHlwZTogVHlwZTtcclxuICAgIGlzU3RhdGljOiBib29sZWFuO1xyXG4gICAgaXNGaW5hbDogYm9vbGVhbjtcclxuICAgIGlzVHJhbnNpZW50OiBib29sZWFuO1xyXG4gICAgdmlzaWJpbGl0eTogVmlzaWJpbGl0eTtcclxuICAgIHVwZGF0ZVZhbHVlOiAodmFsdWU6IFZhbHVlKSA9PiB2b2lkO1xyXG4gICAgdXNhZ2VQb3NpdGlvbnM6IFVzYWdlUG9zaXRpb25zO1xyXG4gICAgZGVjbGFyYXRpb246IFRleHRQb3NpdGlvbldpdGhNb2R1bGU7XHJcbiAgICBkb2N1bWVudGF0aW9uOiBzdHJpbmc7XHJcbiAgICBhbm5vdGF0aW9uPzogc3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgdHlwZTogVHlwZSwgdXBkYXRlVmFsdWU6ICh2YWx1ZTogVmFsdWUpID0+IHZvaWQsXHJcbiAgICAgICAgaXNTdGF0aWM6IGJvb2xlYW4sIHZpc2liaWxpdHk6IFZpc2liaWxpdHksIGlzRmluYWw6IGJvb2xlYW4sIGRvY3VtZW50YXRpb24/OiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmlkZW50aWZpZXIgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XHJcbiAgICAgICAgdGhpcy51cGRhdGVWYWx1ZSA9IHVwZGF0ZVZhbHVlO1xyXG4gICAgICAgIHRoaXMuaXNTdGF0aWMgPSBpc1N0YXRpYztcclxuICAgICAgICB0aGlzLnZpc2liaWxpdHkgPSB2aXNpYmlsaXR5O1xyXG4gICAgICAgIHRoaXMuaXNGaW5hbCA9IGlzRmluYWw7XHJcbiAgICAgICAgdGhpcy51c2FnZVBvc2l0aW9ucyA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLmRvY3VtZW50YXRpb24gPSBkb2N1bWVudGF0aW9uO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTWV0aG9kIGV4dGVuZHMgVHlwZSB7XHJcblxyXG4gICAgb25seUZpcnN0UGFzczogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIHZpc2liaWxpdHk6IFZpc2liaWxpdHk7XHJcblxyXG4gICAgaXNBYnN0cmFjdDogYm9vbGVhbjtcclxuICAgIGlzU3RhdGljOiBib29sZWFuO1xyXG4gICAgaXNDb25zdHJ1Y3RvcjogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgaXNWaXJ0dWFsOiBib29sZWFuID0gZmFsc2U7IC8vIHRydWUsIGlmIGNoaWxkIGNsYXNzIGhhcyBtZXRob2Qgd2l0aCBzYW1lIHNpZ25hdHVyZVxyXG5cclxuICAgIHBhcmFtZXRlcmxpc3Q6IFBhcmFtZXRlcmxpc3Q7XHJcbiAgICByZXR1cm5UeXBlOiBUeXBlO1xyXG4gICAgYW5ub3RhdGlvbj86IHN0cmluZztcclxuXHJcbiAgICBpbnZva2U/OiAocGFyYW1ldGVyczogVmFsdWVbXSkgPT4gYW55OyAgLy8gb25seSBmb3Igc3lzdGVtIGZ1bmN0aW9uc1xyXG4gICAgcHJvZ3JhbT86IFByb2dyYW07XHJcblxyXG4gICAgcmVzZXJ2ZVN0YWNrRm9yTG9jYWxWYXJpYWJsZXM6IG51bWJlciA9IDA7XHJcblxyXG4gICAgaGFzR2VuZXJpY1R5cGVzOiBib29sZWFuO1xyXG5cclxuICAgIGdlbmVyaWNUeXBlTWFwOiB7IFtpZGVudGlmaWVyOiBzdHJpbmddOiBUeXBlIH0gPSBudWxsO1xyXG5cclxuICAgIHB1YmxpYyBzaWduYXR1cmU6IHN0cmluZztcclxuXHJcbiAgICBpbXBsZW1lbnRzKG06IE1ldGhvZCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmKHRoaXMuaWRlbnRpZmllciAhPSBtLmlkZW50aWZpZXIpIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZih0aGlzLnJldHVyblR5cGUgPT0gbnVsbCB8fCB0aGlzLnJldHVyblR5cGUuaWRlbnRpZmllciA9PSBcInZvaWRcIil7XHJcbiAgICAgICAgICAgIGlmKG0ucmV0dXJuVHlwZSAhPSBudWxsICYmIG0ucmV0dXJuVHlwZS5pZGVudGlmaWVyICE9IFwidm9pZFwiKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIGlmKG0ucmV0dXJuVHlwZSBpbnN0YW5jZW9mIFByaW1pdGl2ZVR5cGUpe1xyXG4gICAgICAgICAgICAgICAgaWYobS5yZXR1cm5UeXBlICE9IHRoaXMucmV0dXJuVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIGlmKCF0aGlzLnJldHVyblR5cGUuY2FuQ2FzdFRvKG0ucmV0dXJuVHlwZSkpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0aGlzLnBhcmFtZXRlcmxpc3QucGFyYW1ldGVycy5sZW5ndGggIT0gbS5wYXJhbWV0ZXJsaXN0LnBhcmFtZXRlcnMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCB0aGlzLnBhcmFtZXRlcmxpc3QucGFyYW1ldGVycy5sZW5ndGg7IGkrKyl7XHJcbiAgICAgICAgICAgIGxldCBteVBhcmFtZXRlciA9IHRoaXMucGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzW2ldO1xyXG4gICAgICAgICAgICBsZXQgbVBhcmFtZXRlciA9IG0ucGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzW2ldO1xyXG5cclxuICAgICAgICAgICAgaWYobVBhcmFtZXRlci50eXBlIGluc3RhbmNlb2YgUHJpbWl0aXZlVHlwZSl7XHJcbiAgICAgICAgICAgICAgICBpZihtUGFyYW1ldGVyLnR5cGUgIT0gbXlQYXJhbWV0ZXIudHlwZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2UgaWYoIW1QYXJhbWV0ZXIudHlwZS5jYW5DYXN0VG8obXlQYXJhbWV0ZXIudHlwZSkpIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGhhc0VsbGlwc2lzKCk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGlmKHRoaXMucGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzLmxlbmd0aCA9PSAwKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzW3RoaXMucGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzLmxlbmd0aCAtIDFdLmlzRWxsaXBzaXM7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGdldFBhcmFtZXRlclR5cGUoaW5kZXg6IG51bWJlcik6IFR5cGUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmFtZXRlcmxpc3QucGFyYW1ldGVyc1tpbmRleF0udHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQYXJhbWV0ZXIoaW5kZXg6IG51bWJlcik6IFZhcmlhYmxlIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJhbWV0ZXJsaXN0LnBhcmFtZXRlcnNbaW5kZXhdO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFJldHVyblR5cGUoKTogVHlwZSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmV0dXJuVHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRQYXJhbWV0ZXJDb3VudCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJhbWV0ZXJsaXN0LnBhcmFtZXRlcnMubGVuZ3RoO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFBhcmFtZXRlckxpc3QoKTogUGFyYW1ldGVybGlzdCB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyYW1ldGVybGlzdDtcclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZywgcGFyYW1ldGVybGlzdDogUGFyYW1ldGVybGlzdCwgcmV0dXJuVHlwZTogVHlwZSxcclxuICAgICAgICBpbnZva2VPckFTVDogKChwYXJhbWV0ZXJzOiBWYWx1ZVtdKSA9PiBhbnkpIHwgUHJvZ3JhbSxcclxuICAgICAgICBpc0Fic3RyYWN0OiBib29sZWFuLCBpc1N0YXRpYzogYm9vbGVhbiwgZG9jdW1lbnRhdGlvbj86IHN0cmluZywgaXNDb25zdHJ1Y3RvcjogYm9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLmlkZW50aWZpZXIgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMucGFyYW1ldGVybGlzdCA9IHBhcmFtZXRlcmxpc3Q7XHJcbiAgICAgICAgdGhpcy5yZXR1cm5UeXBlID0gcmV0dXJuVHlwZTtcclxuICAgICAgICB0aGlzLmlzQWJzdHJhY3QgPSBpc0Fic3RyYWN0O1xyXG4gICAgICAgIHRoaXMuaXNTdGF0aWMgPSBpc1N0YXRpYztcclxuICAgICAgICB0aGlzLnZpc2liaWxpdHkgPSAwO1xyXG4gICAgICAgIHRoaXMuZG9jdW1lbnRhdGlvbiA9IGRvY3VtZW50YXRpb247XHJcbiAgICAgICAgdGhpcy5pc0NvbnN0cnVjdG9yID0gaXNDb25zdHJ1Y3RvcjtcclxuXHJcbiAgICAgICAgaWYgKGludm9rZU9yQVNUICE9IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnZva2VPckFTVCA9PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaW52b2tlID0gaW52b2tlT3JBU1Q7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByb2dyYW0gPSBpbnZva2VPckFTVDtcclxuICAgICAgICAgICAgICAgIGludm9rZU9yQVNULm1ldGhvZCA9IHRoaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2lnbmF0dXJlID0gbmFtZSArIHBhcmFtZXRlcmxpc3QuaWQ7XHJcblxyXG4gICAgICAgIGZvciAobGV0IHAgb2YgcGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgIGlmIChwW1wiaXNUeXBlVmFyaWFibGVcIl0gPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYXNHZW5lcmljVHlwZXMgPSB0cnVlOyBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5oYXNHZW5lcmljVHlwZXMgPSB0aGlzLmhhc0dlbmVyaWNUeXBlcyB8fCAodGhpcy5yZXR1cm5UeXBlICE9IG51bGwgJiYgdGhpcy5yZXR1cm5UeXBlW1wiaXNUeXBlVmFyaWFibGVcIl0gPT0gdHJ1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0U2lnbmF0dXJlV2l0aFJldHVyblBhcmFtZXRlcigpe1xyXG4gICAgICAgIGlmKHRoaXMucmV0dXJuVHlwZSAhPSBudWxsKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmV0dXJuVHlwZS5pZGVudGlmaWVyICsgXCIgXCIgKyB0aGlzLnNpZ25hdHVyZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJ2b2lkIFwiICsgdGhpcy5zaWduYXR1cmU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldENvbXBsZXRpb25MYWJlbCgpIHtcclxuXHJcbiAgICAgICAgbGV0IGxhYmVsID0gXCJcIjtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuVHlwZSAhPSBudWxsICYmIHRoaXMucmV0dXJuVHlwZS5pZGVudGlmaWVyICE9IFwidm9pZFwiKSB7XHJcbiAgICAgICAgICAgIGxhYmVsICs9IGdldFR5cGVJZGVudGlmaWVyKHRoaXMucmV0dXJuVHlwZSkgKyBcIiBcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxhYmVsICs9IHRoaXMuaWRlbnRpZmllciArIFwiKFwiO1xyXG5cclxuICAgICAgICBsZXQgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVybGlzdC5wYXJhbWV0ZXJzO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFyYW1ldGVycy5sZW5ndGg7IGkrKykge1xyXG5cclxuICAgICAgICAgICAgbGV0IHAgPSBwYXJhbWV0ZXJzW2ldO1xyXG4gICAgICAgICAgICBpZihwLmlzRWxsaXBzaXMpe1xyXG4gICAgICAgICAgICAgICAgbGV0IGFycmF5VHlwZTogQXJyYXlUeXBlID0gPGFueT5wLnR5cGU7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCArPSBnZXRUeXBlSWRlbnRpZmllcihhcnJheVR5cGUuYXJyYXlPZlR5cGUpICsgXCIuLi4gXCIgKyBwLmlkZW50aWZpZXI7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCArPSBnZXRUeXBlSWRlbnRpZmllcihwLnR5cGUpICsgXCIgXCIgKyBwLmlkZW50aWZpZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChpIDwgcGFyYW1ldGVycy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBsYWJlbCArPSBcIiwgXCI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsYWJlbCArPSBcIilcIjtcclxuXHJcbiAgICAgICAgcmV0dXJuIGxhYmVsO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBnZXRDb21wbGV0aW9uU25pcHBldChsZWZ0QnJhY2tldEFscmVhZHlUaGVyZTogYm9vbGVhbikge1xyXG5cclxuICAgICAgICBpZiAobGVmdEJyYWNrZXRBbHJlYWR5VGhlcmUpIHJldHVybiB0aGlzLmlkZW50aWZpZXIgKyBcIigkMFwiO1xyXG5cclxuICAgICAgICBsZXQgc25pcHBldCA9IFwiXCI7XHJcblxyXG4gICAgICAgIHNuaXBwZXQgKz0gdGhpcy5pZGVudGlmaWVyICsgXCIoXCI7XHJcblxyXG4gICAgICAgIGxldCBpc1ZvaWRSZXR1cm4gPSB0aGlzLnJldHVyblR5cGUgPT0gbnVsbCB8fCB0aGlzLnJldHVyblR5cGUuaWRlbnRpZmllciA9PSBcInZvaWRcIjtcclxuICAgICAgICBsZXQgaXNWb2lkUmV0dXJuRGVsdGEgPSBpc1ZvaWRSZXR1cm4gPyAxIDogMDtcclxuXHJcbiAgICAgICAgbGV0IHBhcmFtZXRlcnMgPSB0aGlzLnBhcmFtZXRlcmxpc3QucGFyYW1ldGVycztcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmFtZXRlcnMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBwID0gcGFyYW1ldGVyc1tpXTtcclxuICAgICAgICAgICAgc25pcHBldCArPSBcIiR7XCIgKyAoKGkgKyAxKSAlIChwYXJhbWV0ZXJzLmxlbmd0aCArIGlzVm9pZFJldHVybkRlbHRhKSkgKyBcIjpcIiArIHAuaWRlbnRpZmllciArIFwifVwiO1xyXG5cclxuICAgICAgICAgICAgaWYgKGkgPCBwYXJhbWV0ZXJzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgIHNuaXBwZXQgKz0gXCIsIFwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgc25pcHBldCArPSBcIilcIjtcclxuXHJcbiAgICAgICAgaWYodGhpcy5yZXR1cm5UeXBlID09IG51bGwgfHwgdGhpcy5yZXR1cm5UeXBlLmlkZW50aWZpZXIgPT0gXCJ2b2lkXCIpe1xyXG4gICAgICAgICAgICBzbmlwcGV0ICs9IFwiOyQwXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc25pcHBldDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGVidWdPdXRwdXQodmFsdWU6IFZhbHVlKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZXF1YWxzKHR5cGU6IFR5cGUpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdHlwZSA9PSB0aGlzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXRSZXN1bHRUeXBlKG9wZXJhdGlvbjogVG9rZW5UeXBlLCBzZWNvbmRPcGVyYW5kVHlwZT86IFR5cGUpOiBUeXBlIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY29tcHV0ZShvcGVyYXRpb246IFRva2VuVHlwZSwgZmlyc3RPcGVyYW5kOiBWYWx1ZSwgc2Vjb25kT3BlcmFuZD86IFZhbHVlKTogYW55IHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2FuQ2FzdFRvKHR5cGU6IFR5cGUpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGNhc3RUbyh2YWx1ZTogVmFsdWUsIHR5cGU6IFR5cGUpOiBWYWx1ZSB7IHJldHVybiB2YWx1ZSB9XHJcblxyXG5cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhcmFtZXRlcmxpc3Qge1xyXG5cclxuICAgIGlkOiBzdHJpbmc7XHJcblxyXG4gICAgcGFyYW1ldGVyczogVmFyaWFibGVbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJzOiBWYXJpYWJsZVtdKSB7XHJcbiAgICAgICAgdGhpcy5wYXJhbWV0ZXJzID0gcGFyYW1ldGVycztcclxuICAgICAgICB0aGlzLmNvbXB1dGVJZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXB1dGVJZCgpIHtcclxuICAgICAgICB0aGlzLmlkID0gXCIoXCI7XHJcbiAgICAgICAgbGV0IGkgPSAwO1xyXG4gICAgICAgIHdoaWxlIChpIDwgdGhpcy5wYXJhbWV0ZXJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmlkICs9IHRoaXMucGFyYW1ldGVyc1tpXS50eXBlLmlkZW50aWZpZXI7XHJcbiAgICAgICAgICAgIGlmIChpIDwgdGhpcy5wYXJhbWV0ZXJzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaWQgKz0gXCIsIFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pZCArPSBcIilcIjtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgVmFyaWFibGUgPSB7XHJcbiAgICBpZGVudGlmaWVyOiBzdHJpbmcsXHJcbiAgICB0eXBlOiBUeXBlLFxyXG4gICAgc3RhY2tQb3M/OiBudW1iZXI7XHJcbiAgICB1c2FnZVBvc2l0aW9uczogVXNhZ2VQb3NpdGlvbnMsXHJcbiAgICBkZWNsYXJhdGlvbjogVGV4dFBvc2l0aW9uV2l0aE1vZHVsZSxcclxuICAgIGlzRmluYWw6IGJvb2xlYW4sXHJcbiAgICBpc0VsbGlwc2lzPzogYm9vbGVhbixcclxuICAgIHZhbHVlPzogVmFsdWUgLy8gb25seSBmb3IgdmFyaWFibGVzIG9uIGhlYXAsXHJcbiAgICBkZWNsYXJhdGlvbkVycm9yPzogYW55LCAgICAgLy8gaWYgdi5kZWNsYXJhdGlvbkVycm9yICE9IG51bGwgdGhlbiB2YXJpYWJsZSBoYXMgYmVlbiB1c2VkIGJlZm9yZSBpbml0aWFsaXphdGlvbi5cclxuICAgIHVzZWRCZWZvcmVJbml0aWFsaXphdGlvbj86IGJvb2xlYW4sXHJcbiAgICBpbml0aWFsaXplZD86IGJvb2xlYW5cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgSGVhcCA9IHsgW2lkZW50aWZpZXI6IHN0cmluZ106IFZhcmlhYmxlIH07XHJcblxyXG5leHBvcnQgdHlwZSBWYWx1ZSA9IHtcclxuICAgIHR5cGU6IFR5cGU7XHJcbiAgICB2YWx1ZTogYW55O1xyXG4gICAgdXBkYXRlVmFsdWU/OiAodmFsdWU6IFZhbHVlKSA9PiB2b2lkO1xyXG4gICAgb2JqZWN0PzogUnVudGltZU9iamVjdDtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRUeXBlSWRlbnRpZmllcih0eXBlOiBUeXBlKTogc3RyaW5nIHtcclxuICAgIGlmKHR5cGVbXCJ0eXBlVmFyaWFibGVzXCJdKXtcclxuICAgICAgICBpZih0eXBlW1widHlwZVZhcmlhYmxlc1wiXS5sZW5ndGggPiAwKXtcclxuICAgICAgICAgICAgbGV0IHM6IHN0cmluZyA9ICh0eXBlW1wiaXNUeXBlVmFyaWFibGVcIl0gPyAodHlwZS5pZGVudGlmaWVyICsgXCIgZXh0ZW5kcyBcIiArIHR5cGVbXCJpc0dlbmVyaWNWYXJpYW50RnJvbVwiXT8uaWRlbnRpZmllcikgOiB0eXBlLmlkZW50aWZpZXIpIFxyXG4gICAgICAgICAgICArIFwiPFwiO1xyXG4gICAgICAgICAgICAgICBzICs9IHR5cGVbXCJ0eXBlVmFyaWFibGVzXCJdLm1hcCh0diA9PiBnZXRUeXBlSWRlbnRpZmllcih0di50eXBlKSkuam9pbihcIiwgXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gcyArIFwiPlwiO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdHlwZVtcImlzVHlwZVZhcmlhYmxlXCJdID8gKHR5cGUuaWRlbnRpZmllciArIFwiIGV4dGVuZHMgXCIgKyB0eXBlW1wiaXNHZW5lcmljVmFyaWFudEZyb21cIl0/LmlkZW50aWZpZXIpIDogdHlwZS5pZGVudGlmaWVyO1xyXG59XHJcbiJdfQ==