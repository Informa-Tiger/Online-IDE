import { escapeHtml } from "./StringTools.js";
export function makeEditable(elementWithText, elementToReplace, renameDoneCallback, selectionRange = null) {
    let mousePointer = window.PointerEvent ? "pointer" : "mouse";
    if (elementToReplace == null) {
        elementToReplace = elementWithText;
    }
    let $input = jQuery('<input type="text" class="jo_inplaceeditor" spellcheck="false">');
    $input.css({
        width: elementToReplace.css('width'),
        height: elementToReplace.css('height'),
        color: elementToReplace.css('color'),
        position: elementToReplace.css('position'),
        "background-color": elementToReplace.css('background-color'),
        "font-size": elementToReplace.css('font-size'),
        "font-weight": elementToReplace.css('font-weight'),
        "box-sizing": "border-box"
    });
    $input.val(elementWithText.text());
    $input.on(mousePointer + "down", (e) => { e.stopPropagation(); });
    if (selectionRange != null) {
        $input[0].setSelectionRange(selectionRange.start, selectionRange.end);
    }
    elementToReplace.after($input);
    elementToReplace.hide();
    setTimeout(() => {
        $input.focus();
    }, 300);
    $input.on("keydown.me", (ev) => {
        if (ev.key == "Enter" || ev.key == "Escape") {
            $input.off("keydown.me");
            $input.off("focusout.me");
            $input.remove();
            elementToReplace.show();
            let newValue = escapeHtml($input.val());
            renameDoneCallback(newValue);
            return;
        }
    });
    $input.on("focusout.me", (ev) => {
        $input.off("keydown.me");
        $input.off("focusout.me");
        $input.remove();
        elementToReplace.show();
        let newValue = escapeHtml($input.val());
        renameDoneCallback(newValue);
        return;
    });
}
export function openContextMenu(items, x, y) {
    let mousePointer = window.PointerEvent ? "pointer" : "mouse";
    let $contextMenu = jQuery('<div class="jo_contextmenu"></div>');
    let $openSubMenu = null;
    let parentMenuItem = null;
    for (let mi of items) {
        let caption = mi.caption;
        if (mi.link != null) {
            caption = `<a href="${mi.link}" target="_blank" class="jo_menulink">${mi.caption}</a>`;
        }
        let $item = jQuery('<div>' + caption + (mi.subMenu != null ? '<span style="float: right"> &nbsp; &nbsp; &gt;</span>' : "") + '</div>');
        if (mi.color != null) {
            $item.css('color', mi.color);
        }
        if (mi.link == null) {
            $item.on(mousePointer + 'up.contextmenu', (ev) => {
                ev.stopPropagation();
                jQuery('.jo_contextmenu').remove();
                jQuery(document).off(mousePointer + "up.contextmenu");
                jQuery(document).off(mousePointer + "down.contextmenu");
                jQuery(document).off("keydown.contextmenu");
                mi.callback();
            });
            $item.on(mousePointer + 'down.contextmenu', (ev) => {
                ev.stopPropagation();
            });
        }
        else {
            let $link = $item.find('a');
            $link.on(mousePointer + "up", (event) => {
                event.stopPropagation();
                setTimeout(() => {
                    $item.hide();
                }, 500);
            });
            $link.on(mousePointer + "down", (event) => {
                event.stopPropagation();
            });
        }
        $item.on(mousePointer + 'move.contextmenu', () => {
            if (mi != parentMenuItem && $openSubMenu != null) {
                $openSubMenu.remove();
                parentMenuItem = null;
                $openSubMenu = null;
            }
            if (mi.subMenu != null) {
                $openSubMenu = openContextMenu(mi.subMenu, $item.offset().left + $item.width(), $item.offset().top);
            }
        });
        $contextMenu.append($item);
    }
    jQuery(document).on(mousePointer + "down.contextmenu", (e) => {
        jQuery(document).off(mousePointer + "down.contextmenu");
        jQuery(document).off("keydown.contextmenu");
        jQuery('.jo_contextmenu').remove();
    });
    jQuery(document).on("keydown.contextmenu", (ev) => {
        if (ev.key == "Escape") {
            jQuery(document).off(mousePointer + "up.contextmenu");
            jQuery(document).off("keydown.contextmenu");
            jQuery('.jo_contextmenu').remove();
        }
    });
    let leftRight = x > window.innerWidth * 0.8 ? "right" : "left";
    let xp = x > window.innerWidth * 0.8 ? window.innerWidth - x : x;
    let topBottom = y > window.innerHeight * 0.8 ? "bottom" : "top";
    let yp = y > window.innerHeight * 0.8 ? window.innerHeight - y : y;
    let css = {};
    css[leftRight] = xp + "px";
    css[topBottom] = yp + "px";
    $contextMenu.css(css);
    jQuery("body").append($contextMenu);
    $contextMenu.show();
    return $contextMenu;
}
export function makeTabs(tabDiv) {
    let headings = tabDiv.find('.jo_tabheadings>div').not('.jo_noHeading');
    let tabs = tabDiv.find('.jo_tabs>div');
    let mousePointer = window.PointerEvent ? "pointer" : "mouse";
    headings.on(mousePointer + "down", (ev) => {
        let target = jQuery(ev.target);
        headings.removeClass('jo_active');
        target.addClass('jo_active');
        let tab = tabDiv.find('.' + target.data('target'));
        tabs.removeClass('jo_active');
        tabs.trigger('myhide');
        tab.addClass('jo_active');
        tab.trigger('myshow');
    });
}
export function convertPxToNumber(pxString) {
    pxString = pxString.replace('px', '').trim();
    return Number.parseInt(pxString);
}
export function makeDiv(id, klass = "", text = "", css) {
    let s = "";
    if (id != null && id != "")
        s += ` id="${id}"`;
    if (klass != null && klass != "")
        s += ` class="${klass}"`;
    let div = jQuery(`<div${s}></div>`);
    if (css != null) {
        div.css(css);
    }
    if (text != null && text != "") {
        div.text(text);
    }
    return div;
}
export function setSelectItems($selectElement, items, activeItemValue) {
    $selectElement.empty();
    items.forEach(item => {
        let selected = (item.value == activeItemValue) ? ' selected="selected"' : "";
        let element = jQuery(`<option value=${item.value}${selected}>${item.caption}</option>`);
        $selectElement.append(element);
        element.data('object', item.object);
    });
    $selectElement.data('items', items);
}
export function getSelectedObject($selectDiv) {
    var _a;
    let items = $selectDiv.data('items');
    let selectedValue = $selectDiv.val();
    return (_a = items.find(item => item.value == selectedValue)) === null || _a === void 0 ? void 0 : _a.object;
}
export var jo_mouseDetected = false;
export function checkIfMousePresent() {
    if (matchMedia('(pointer:fine)').matches) {
        jo_mouseDetected = true;
    }
}
export function animateToTransparent($element, cssProperty, startColorRgb, duration) {
    let colorPraefix = 'rgba(' + startColorRgb[0] + ", " + startColorRgb[1] + ", " + startColorRgb[2] + ", ";
    let value = 1.0;
    let delta = value / (duration / 20);
    let animate = () => {
        $element.css(cssProperty, colorPraefix + value + ")");
        value -= delta;
        if (value < 0) {
            $element.css(cssProperty, "");
        }
        else {
            setTimeout(animate, 20);
        }
    };
    animate();
}
export function downloadFile(obj, filename, isBlob = false) {
    var blob = isBlob ? obj : new Blob([JSON.stringify(obj)], { type: 'text/plain' });
    //@ts-ignore
    if (window.navigator && window.navigator.msSaveOrOpenBlob) {
        //@ts-ignore
        window.navigator.msSaveOrOpenBlob(blob, filename);
    }
    else {
        var e = document.createEvent('MouseEvents'), a = document.createElement('a');
        a.download = filename;
        a.href = window.URL.createObjectURL(blob);
        a.dataset.downloadurl = ['text/plain', a.download, a.href].join(':');
        //@ts-ignore
        e.initEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        a.dispatchEvent(e);
        a.remove();
    }
}
function fallbackCopyTextToClipboard(text) {
    var textArea = document.createElement("textarea");
    textArea.value = text;
    // Avoid scrolling to bottom
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.position = "fixed";
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    try {
        var successful = document.execCommand('copy');
    }
    catch (err) {
        console.error('Fallback: Oops, unable to copy', err);
    }
    document.body.removeChild(textArea);
}
export function copyTextToClipboard(text) {
    if (!navigator.clipboard) {
        fallbackCopyTextToClipboard(text);
        return;
    }
    navigator.clipboard.writeText(text).then(function () {
    }, function (err) {
        console.error('Async: Could not copy text: ', err);
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSHRtbFRvb2xzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC90b29scy9IdG1sVG9vbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRTlDLE1BQU0sVUFBVSxZQUFZLENBQUMsZUFBb0MsRUFDN0QsZ0JBQXFDLEVBQ3JDLGtCQUFnRCxFQUFFLGlCQUFpRCxJQUFJO0lBRXZHLElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO0lBRTdELElBQUksZ0JBQWdCLElBQUksSUFBSSxFQUFFO1FBQzFCLGdCQUFnQixHQUFHLGVBQWUsQ0FBQztLQUN0QztJQUVELElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxpRUFBaUUsQ0FBQyxDQUFDO0lBQ3ZGLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDUCxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztRQUNwQyxNQUFNLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztRQUN0QyxLQUFLLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztRQUNwQyxRQUFRLEVBQUUsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztRQUMxQyxrQkFBa0IsRUFBRSxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUM7UUFDNUQsV0FBVyxFQUFFLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUM7UUFDOUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUM7UUFDbEQsWUFBWSxFQUFFLFlBQVk7S0FDN0IsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUNu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QyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0tBQ3hEO0lBRUQsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUVELE1BQU0sVUFBVSxtQkFBbUIsQ0FBQyxJQUFJO0lBQ3BDLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFO1FBQ3RCLDJCQUEyQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLE9BQU87S0FDVjtJQUNELFNBQVMsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQztJQUN6QyxDQUFDLEVBQUUsVUFBVSxHQUFHO1FBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN2RCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlc2NhcGVIdG1sIH0gZnJvbSBcIi4vU3RyaW5nVG9vbHMuanNcIjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtYWtlRWRpdGFibGUoZWxlbWVudFdpdGhUZXh0OiBKUXVlcnk8SFRNTEVsZW1lbnQ+LFxyXG4gICAgZWxlbWVudFRvUmVwbGFjZTogSlF1ZXJ5PEhUTUxFbGVtZW50PixcclxuICAgIHJlbmFtZURvbmVDYWxsYmFjazogKG5ld0NvbnRlbnQ6IHN0cmluZykgPT4gdm9pZCwgc2VsZWN0aW9uUmFuZ2U6IHsgc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIgfSA9IG51bGwpIHtcclxuXHJcbiAgICBsZXQgbW91c2VQb2ludGVyID0gd2luZG93LlBvaW50ZXJFdmVudCA/IFwicG9pbnRlclwiIDogXCJtb3VzZVwiO1xyXG5cclxuICAgIGlmIChlbGVtZW50VG9SZXBsYWNlID09IG51bGwpIHtcclxuICAgICAgICBlbGVtZW50VG9SZXBsYWNlID0gZWxlbWVudFdpdGhUZXh0O1xyXG4gICAgfVxyXG5cclxuICAgIGxldCAkaW5wdXQgPSBqUXVlcnkoJzxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiam9faW5wbGFjZWVkaXRvclwiIHNwZWxsY2hlY2s9XCJmYWxzZVwiPicpO1xyXG4gICAgJGlucHV0LmNzcyh7XHJcbiAgICAgICAgd2lkdGg6IGVsZW1lbnRUb1JlcGxhY2UuY3NzKCd3aWR0aCcpLFxyXG4gICAgICAgIGhlaWdodDogZWxlbWVudFRvUmVwbGFjZS5jc3MoJ2hlaWdodCcpLFxyXG4gICAgICAgIGNvbG9yOiBlbGVtZW50VG9SZXBsYWNlLmNzcygnY29sb3InKSxcclxuICAgICAgICBwb3NpdGlvbjogZWxlbWVudFRvUmVwbGFjZS5jc3MoJ3Bvc2l0aW9uJyksXHJcbiAgICAgICAgXCJiYWNrZ3JvdW5kLWNvbG9yXCI6IGVsZW1lbnRUb1JlcGxhY2UuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJyksXHJcbiAgICAgICAgXCJmb250LXNpemVcIjogZWxlbWVudFRvUmVwbGFjZS5jc3MoJ2ZvbnQtc2l6ZScpLFxyXG4gICAgICAgIFwiZm9udC13ZWlnaHRcIjogZWxlbWVudFRvUmVwbGFjZS5jc3MoJ2ZvbnQtd2VpZ2h0JyksXHJcbiAgICAgICAgXCJib3gtc2l6aW5nXCI6IFwiYm9yZGVyLWJveFwiXHJcbiAgICB9KTtcclxuICAgICRpbnB1dC52YWwoZWxlbWVudFdpdGhUZXh0LnRleHQoKSk7XHJcbiAgICAkaW5wdXQub24obW91c2VQb2ludGVyICsgXCJkb3duXCIsIChlKSA9PiB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IH0pXHJcblxyXG4gICAgaWYgKHNlbGVjdGlvblJhbmdlICE9IG51bGwpIHtcclxuICAgICAgICAoPEhUTUxJbnB1dEVsZW1lbnQ+JGlucHV0WzBdKS5zZXRTZWxlY3Rpb25SYW5nZShzZWxlY3Rpb25SYW5nZS5zdGFydCwgc2VsZWN0aW9uUmFuZ2UuZW5kKTtcclxuICAgIH1cclxuXHJcbiAgICBlbGVtZW50VG9SZXBsYWNlLmFmdGVyKCRpbnB1dCk7XHJcbiAgICBlbGVtZW50VG9SZXBsYWNlLmhpZGUoKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICRpbnB1dC5mb2N1cygpO1xyXG4gICAgfSwgMzAwKTtcclxuXHJcbiAgICAkaW5wdXQub24oXCJrZXlkb3duLm1lXCIsIChldikgPT4ge1xyXG4gICAgICAgIGlmIChldi5rZXkgPT0gXCJFbnRlclwiIHx8IGV2LmtleSA9PSBcIkVzY2FwZVwiKSB7XHJcbiAgICAgICAgICAgICRpbnB1dC5vZmYoXCJrZXlkb3duLm1lXCIpO1xyXG4gICAgICAgICAgICAkaW5wdXQub2ZmKFwiZm9jdXNvdXQubWVcIik7XHJcbiAgICAgICAgICAgICRpbnB1dC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgZWxlbWVudFRvUmVwbGFjZS5zaG93KCk7XHJcbiAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IGVzY2FwZUh0bWwoPHN0cmluZz4kaW5wdXQudmFsKCkpO1xyXG4gICAgICAgICAgICByZW5hbWVEb25lQ2FsbGJhY2sobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJGlucHV0Lm9uKFwiZm9jdXNvdXQubWVcIiwgKGV2KSA9PiB7XHJcbiAgICAgICAgJGlucHV0Lm9mZihcImtleWRvd24ubWVcIik7XHJcbiAgICAgICAgJGlucHV0Lm9mZihcImZvY3Vzb3V0Lm1lXCIpO1xyXG4gICAgICAgICRpbnB1dC5yZW1vdmUoKTtcclxuICAgICAgICBlbGVtZW50VG9SZXBsYWNlLnNob3coKTtcclxuICAgICAgICBsZXQgbmV3VmFsdWUgPSBlc2NhcGVIdG1sKDxzdHJpbmc+JGlucHV0LnZhbCgpKTtcclxuICAgICAgICByZW5hbWVEb25lQ2FsbGJhY2sobmV3VmFsdWUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH0pO1xyXG5cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgQ29udGV4dE1lbnVJdGVtID0ge1xyXG4gICAgY2FwdGlvbjogc3RyaW5nO1xyXG4gICAgY29sb3I/OiBzdHJpbmc7XHJcbiAgICBjYWxsYmFjazogKCkgPT4gdm9pZDtcclxuICAgIGxpbms/OiBzdHJpbmc7XHJcbiAgICBzdWJNZW51PzogQ29udGV4dE1lbnVJdGVtW11cclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBvcGVuQ29udGV4dE1lbnUoaXRlbXM6IENvbnRleHRNZW51SXRlbVtdLCB4OiBudW1iZXIsIHk6IG51bWJlcik6IEpRdWVyeTxIVE1MRWxlbWVudD4ge1xyXG5cclxuICAgIGxldCBtb3VzZVBvaW50ZXIgPSB3aW5kb3cuUG9pbnRlckV2ZW50ID8gXCJwb2ludGVyXCIgOiBcIm1vdXNlXCI7XHJcblxyXG4gICAgbGV0ICRjb250ZXh0TWVudSA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cImpvX2NvbnRleHRtZW51XCI+PC9kaXY+Jyk7XHJcblxyXG4gICAgbGV0ICRvcGVuU3ViTWVudTogSlF1ZXJ5PEhUTUxFbGVtZW50PiA9IG51bGw7XHJcbiAgICBsZXQgcGFyZW50TWVudUl0ZW06IENvbnRleHRNZW51SXRlbSA9IG51bGw7XHJcblxyXG4gICAgZm9yIChsZXQgbWkgb2YgaXRlbXMpIHtcclxuICAgICAgICBsZXQgY2FwdGlvbjogc3RyaW5nID0gbWkuY2FwdGlvbjtcclxuICAgICAgICBpZiAobWkubGluayAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgIGNhcHRpb24gPSBgPGEgaHJlZj1cIiR7bWkubGlua31cIiB0YXJnZXQ9XCJfYmxhbmtcIiBjbGFzcz1cImpvX21lbnVsaW5rXCI+JHttaS5jYXB0aW9ufTwvYT5gO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgJGl0ZW0gPSBqUXVlcnkoJzxkaXY+JyArIGNhcHRpb24gKyAobWkuc3ViTWVudSAhPSBudWxsID8gJzxzcGFuIHN0eWxlPVwiZmxvYXQ6IHJpZ2h0XCI+ICZuYnNwOyAmbmJzcDsgJmd0Ozwvc3Bhbj4nIDogXCJcIikgKyAnPC9kaXY+Jyk7XHJcbiAgICAgICAgaWYgKG1pLmNvbG9yICE9IG51bGwpIHtcclxuICAgICAgICAgICAgJGl0ZW0uY3NzKCdjb2xvcicsIG1pLmNvbG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1pLmxpbmsgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAkaXRlbS5vbihtb3VzZVBvaW50ZXIgKyAndXAuY29udGV4dG1lbnUnLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KCcuam9fY29udGV4dG1lbnUnKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIGpRdWVyeShkb2N1bWVudCkub2ZmKG1vdXNlUG9pbnRlciArIFwidXAuY29udGV4dG1lbnVcIik7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9mZihtb3VzZVBvaW50ZXIgKyBcImRvd24uY29udGV4dG1lbnVcIik7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLm9mZihcImtleWRvd24uY29udGV4dG1lbnVcIik7XHJcbiAgICAgICAgICAgICAgICBtaS5jYWxsYmFjaygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgJGl0ZW0ub24obW91c2VQb2ludGVyICsgJ2Rvd24uY29udGV4dG1lbnUnLCAoZXYpID0+IHtcclxuICAgICAgICAgICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgJGxpbmsgPSAkaXRlbS5maW5kKCdhJyk7XHJcbiAgICAgICAgICAgICRsaW5rLm9uKG1vdXNlUG9pbnRlciArIFwidXBcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICRpdGVtLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH0sIDUwMCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICRsaW5rLm9uKG1vdXNlUG9pbnRlciArIFwiZG93blwiLCAoZXZlbnQpID0+IHtcclxuICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRpdGVtLm9uKG1vdXNlUG9pbnRlciArICdtb3ZlLmNvbnRleHRtZW51JywgKCkgPT4ge1xyXG4gICAgICAgICAgICBpZiAobWkgIT0gcGFyZW50TWVudUl0ZW0gJiYgJG9wZW5TdWJNZW51ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICRvcGVuU3ViTWVudS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIHBhcmVudE1lbnVJdGVtID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICRvcGVuU3ViTWVudSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1pLnN1Yk1lbnUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgJG9wZW5TdWJNZW51ID0gb3BlbkNvbnRleHRNZW51KG1pLnN1Yk1lbnUsICRpdGVtLm9mZnNldCgpLmxlZnQgKyAkaXRlbS53aWR0aCgpLCAkaXRlbS5vZmZzZXQoKS50b3ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRjb250ZXh0TWVudS5hcHBlbmQoJGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIGpRdWVyeShkb2N1bWVudCkub24obW91c2VQb2ludGVyICsgXCJkb3duLmNvbnRleHRtZW51XCIsIChlKSA9PiB7XHJcbiAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYobW91c2VQb2ludGVyICsgXCJkb3duLmNvbnRleHRtZW51XCIpO1xyXG4gICAgICAgIGpRdWVyeShkb2N1bWVudCkub2ZmKFwia2V5ZG93bi5jb250ZXh0bWVudVwiKTtcclxuICAgICAgICBqUXVlcnkoJy5qb19jb250ZXh0bWVudScpLnJlbW92ZSgpO1xyXG4gICAgfSlcclxuXHJcbiAgICBqUXVlcnkoZG9jdW1lbnQpLm9uKFwia2V5ZG93bi5jb250ZXh0bWVudVwiLCAoZXYpID0+IHtcclxuICAgICAgICBpZiAoZXYua2V5ID09IFwiRXNjYXBlXCIpIHtcclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYobW91c2VQb2ludGVyICsgXCJ1cC5jb250ZXh0bWVudVwiKTtcclxuICAgICAgICAgICAgalF1ZXJ5KGRvY3VtZW50KS5vZmYoXCJrZXlkb3duLmNvbnRleHRtZW51XCIpO1xyXG4gICAgICAgICAgICBqUXVlcnkoJy5qb19jb250ZXh0bWVudScpLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGxldCBsZWZ0UmlnaHQgPSB4ID4gd2luZG93LmlubmVyV2lkdGggKiAwLjggPyBcInJpZ2h0XCIgOiBcImxlZnRcIjtcclxuICAgIGxldCB4cCA9IHggPiB3aW5kb3cuaW5uZXJXaWR0aCAqIDAuOCA/IHdpbmRvdy5pbm5lcldpZHRoIC0geCA6IHg7XHJcbiAgICBsZXQgdG9wQm90dG9tID0geSA+IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuOCA/IFwiYm90dG9tXCIgOiBcInRvcFwiO1xyXG4gICAgbGV0IHlwID0geSA+IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuOCA/IHdpbmRvdy5pbm5lckhlaWdodCAtIHkgOiB5O1xyXG5cclxuICAgIGxldCBjc3MgPSB7fTtcclxuICAgIGNzc1tsZWZ0UmlnaHRdID0geHAgKyBcInB4XCI7XHJcbiAgICBjc3NbdG9wQm90dG9tXSA9IHlwICsgXCJweFwiO1xyXG5cclxuICAgICRjb250ZXh0TWVudS5jc3MoY3NzKTtcclxuXHJcblxyXG4gICAgalF1ZXJ5KFwiYm9keVwiKS5hcHBlbmQoJGNvbnRleHRNZW51KTtcclxuICAgICRjb250ZXh0TWVudS5zaG93KCk7XHJcblxyXG4gICAgcmV0dXJuICRjb250ZXh0TWVudTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VUYWJzKHRhYkRpdjogSlF1ZXJ5PEhUTUxFbGVtZW50Pikge1xyXG4gICAgbGV0IGhlYWRpbmdzID0gdGFiRGl2LmZpbmQoJy5qb190YWJoZWFkaW5ncz5kaXYnKS5ub3QoJy5qb19ub0hlYWRpbmcnKTtcclxuICAgIGxldCB0YWJzID0gdGFiRGl2LmZpbmQoJy5qb190YWJzPmRpdicpO1xyXG5cclxuICAgIGxldCBtb3VzZVBvaW50ZXIgPSB3aW5kb3cuUG9pbnRlckV2ZW50ID8gXCJwb2ludGVyXCIgOiBcIm1vdXNlXCI7XHJcblxyXG4gICAgaGVhZGluZ3Mub24obW91c2VQb2ludGVyICsgXCJkb3duXCIsIChldikgPT4ge1xyXG4gICAgICAgIGxldCB0YXJnZXQgPSBqUXVlcnkoZXYudGFyZ2V0KTtcclxuICAgICAgICBoZWFkaW5ncy5yZW1vdmVDbGFzcygnam9fYWN0aXZlJyk7XHJcbiAgICAgICAgdGFyZ2V0LmFkZENsYXNzKCdqb19hY3RpdmUnKTtcclxuICAgICAgICBsZXQgdGFiID0gdGFiRGl2LmZpbmQoJy4nICsgdGFyZ2V0LmRhdGEoJ3RhcmdldCcpKTtcclxuICAgICAgICB0YWJzLnJlbW92ZUNsYXNzKCdqb19hY3RpdmUnKTtcclxuICAgICAgICB0YWJzLnRyaWdnZXIoJ215aGlkZScpO1xyXG4gICAgICAgIHRhYi5hZGRDbGFzcygnam9fYWN0aXZlJyk7XHJcbiAgICAgICAgdGFiLnRyaWdnZXIoJ215c2hvdycpO1xyXG4gICAgfSk7XHJcblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY29udmVydFB4VG9OdW1iZXIocHhTdHJpbmc6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICBweFN0cmluZyA9IHB4U3RyaW5nLnJlcGxhY2UoJ3B4JywgJycpLnRyaW0oKTtcclxuICAgIHJldHVybiBOdW1iZXIucGFyc2VJbnQocHhTdHJpbmcpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWFrZURpdihpZDogc3RyaW5nLCBrbGFzczogc3RyaW5nID0gXCJcIiwgdGV4dDogc3RyaW5nID0gXCJcIiwgY3NzPzogeyBbaWQ6IHN0cmluZ106IGFueSB9KTogSlF1ZXJ5PEhUTUxEaXZFbGVtZW50PiB7XHJcblxyXG4gICAgbGV0IHMgPSBcIlwiO1xyXG4gICAgaWYgKGlkICE9IG51bGwgJiYgaWQgIT0gXCJcIikgcyArPSBgIGlkPVwiJHtpZH1cImA7XHJcblxyXG4gICAgaWYgKGtsYXNzICE9IG51bGwgJiYga2xhc3MgIT0gXCJcIikgcyArPSBgIGNsYXNzPVwiJHtrbGFzc31cImA7XHJcblxyXG4gICAgbGV0IGRpdiA9IGpRdWVyeShgPGRpdiR7c30+PC9kaXY+YCk7XHJcblxyXG4gICAgaWYgKGNzcyAhPSBudWxsKSB7XHJcbiAgICAgICAgZGl2LmNzcyhjc3MpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0ZXh0ICE9IG51bGwgJiYgdGV4dCAhPSBcIlwiKSB7XHJcbiAgICAgICAgZGl2LnRleHQodGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIDxhbnk+ZGl2O1xyXG5cclxufVxyXG5cclxuZXhwb3J0IHR5cGUgU2VsZWN0SXRlbSA9IHtcclxuICAgIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIsXHJcbiAgICBvYmplY3Q6IGFueSxcclxuICAgIGNhcHRpb246IHN0cmluZ1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0U2VsZWN0SXRlbXMoJHNlbGVjdEVsZW1lbnQ6IEpRdWVyeTxIVE1MU2VsZWN0RWxlbWVudD4sIGl0ZW1zOiBTZWxlY3RJdGVtW10sIGFjdGl2ZUl0ZW1WYWx1ZT86IHN0cmluZyB8IG51bWJlcikge1xyXG4gICAgJHNlbGVjdEVsZW1lbnQuZW1wdHkoKTtcclxuICAgIGl0ZW1zLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgbGV0IHNlbGVjdGVkOiBzdHJpbmcgPSAoaXRlbS52YWx1ZSA9PSBhY3RpdmVJdGVtVmFsdWUpID8gJyBzZWxlY3RlZD1cInNlbGVjdGVkXCInIDogXCJcIjtcclxuICAgICAgICBsZXQgZWxlbWVudCA9IGpRdWVyeShgPG9wdGlvbiB2YWx1ZT0ke2l0ZW0udmFsdWV9JHtzZWxlY3RlZH0+JHtpdGVtLmNhcHRpb259PC9vcHRpb24+YCk7XHJcbiAgICAgICAgJHNlbGVjdEVsZW1lbnQuYXBwZW5kKGVsZW1lbnQpO1xyXG4gICAgICAgIGVsZW1lbnQuZGF0YSgnb2JqZWN0JywgaXRlbS5vYmplY3QpO1xyXG4gICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICAkc2VsZWN0RWxlbWVudC5kYXRhKCdpdGVtcycsIGl0ZW1zKTtcclxuXHJcblxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VsZWN0ZWRPYmplY3QoJHNlbGVjdERpdjogSlF1ZXJ5PEhUTUxTZWxlY3RFbGVtZW50Pikge1xyXG5cclxuICAgIGxldCBpdGVtczogU2VsZWN0SXRlbVtdID0gJHNlbGVjdERpdi5kYXRhKCdpdGVtcycpO1xyXG5cclxuICAgIGxldCBzZWxlY3RlZFZhbHVlID0gJHNlbGVjdERpdi52YWwoKTtcclxuXHJcbiAgICByZXR1cm4gaXRlbXMuZmluZChpdGVtID0+IGl0ZW0udmFsdWUgPT0gc2VsZWN0ZWRWYWx1ZSk/Lm9iamVjdDtcclxuXHJcbn1cclxuXHJcbmV4cG9ydCB2YXIgam9fbW91c2VEZXRlY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tJZk1vdXNlUHJlc2VudCgpIHtcclxuICAgIGlmIChtYXRjaE1lZGlhKCcocG9pbnRlcjpmaW5lKScpLm1hdGNoZXMpIHtcclxuICAgICAgICBqb19tb3VzZURldGVjdGVkID0gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFuaW1hdGVUb1RyYW5zcGFyZW50KCRlbGVtZW50OiBKUXVlcnk8SFRNTEVsZW1lbnQ+LCBjc3NQcm9wZXJ0eTogc3RyaW5nLCBzdGFydENvbG9yUmdiOiBudW1iZXJbXSwgZHVyYXRpb246IG51bWJlcikge1xyXG4gICAgbGV0IGNvbG9yUHJhZWZpeCA9ICdyZ2JhKCcgKyBzdGFydENvbG9yUmdiWzBdICsgXCIsIFwiICsgc3RhcnRDb2xvclJnYlsxXSArIFwiLCBcIiArIHN0YXJ0Q29sb3JSZ2JbMl0gKyBcIiwgXCI7XHJcbiAgICBsZXQgdmFsdWUgPSAxLjA7XHJcbiAgICBsZXQgZGVsdGEgPSB2YWx1ZSAvIChkdXJhdGlvbiAvIDIwKTtcclxuXHJcbiAgICBsZXQgYW5pbWF0ZSA9ICgpID0+IHtcclxuICAgICAgICAkZWxlbWVudC5jc3MoY3NzUHJvcGVydHksIGNvbG9yUHJhZWZpeCArIHZhbHVlICsgXCIpXCIpO1xyXG4gICAgICAgIHZhbHVlIC09IGRlbHRhO1xyXG4gICAgICAgIGlmICh2YWx1ZSA8IDApIHtcclxuICAgICAgICAgICAgJGVsZW1lbnQuY3NzKGNzc1Byb3BlcnR5LCBcIlwiKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KGFuaW1hdGUsIDIwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYW5pbWF0ZSgpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZG93bmxvYWRGaWxlKG9iajogYW55LCBmaWxlbmFtZTogc3RyaW5nLCBpc0Jsb2I6IGJvb2xlYW4gPSBmYWxzZSkge1xyXG4gICAgdmFyIGJsb2IgPSBpc0Jsb2I/IG9iaiA6IG5ldyBCbG9iKFtKU09OLnN0cmluZ2lmeShvYmopXSwgeyB0eXBlOiAndGV4dC9wbGFpbicgfSk7XHJcbiAgICAvL0B0cy1pZ25vcmVcclxuICAgIGlmICh3aW5kb3cubmF2aWdhdG9yICYmIHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYikge1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIHdpbmRvdy5uYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBmaWxlbmFtZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ01vdXNlRXZlbnRzJyksXHJcbiAgICAgICAgICAgIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgICAgICAgYS5kb3dubG9hZCA9IGZpbGVuYW1lO1xyXG4gICAgICAgIGEuaHJlZiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG4gICAgICAgIGEuZGF0YXNldC5kb3dubG9hZHVybCA9IFsndGV4dC9wbGFpbicsIGEuZG93bmxvYWQsIGEuaHJlZl0uam9pbignOicpO1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgIGUuaW5pdEV2ZW50KCdjbGljaycsIHRydWUsIGZhbHNlLCB3aW5kb3csIDAsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCBudWxsKTtcclxuICAgICAgICBhLmRpc3BhdGNoRXZlbnQoZSk7XHJcbiAgICAgICAgYS5yZW1vdmUoKTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIGZhbGxiYWNrQ29weVRleHRUb0NsaXBib2FyZCh0ZXh0KSB7XHJcbiAgICB2YXIgdGV4dEFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGV4dGFyZWFcIik7XHJcbiAgICB0ZXh0QXJlYS52YWx1ZSA9IHRleHQ7XHJcblxyXG4gICAgLy8gQXZvaWQgc2Nyb2xsaW5nIHRvIGJvdHRvbVxyXG4gICAgdGV4dEFyZWEuc3R5bGUudG9wID0gXCIwXCI7XHJcbiAgICB0ZXh0QXJlYS5zdHlsZS5sZWZ0ID0gXCIwXCI7XHJcbiAgICB0ZXh0QXJlYS5zdHlsZS5wb3NpdGlvbiA9IFwiZml4ZWRcIjtcclxuXHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRleHRBcmVhKTtcclxuICAgIHRleHRBcmVhLmZvY3VzKCk7XHJcbiAgICB0ZXh0QXJlYS5zZWxlY3QoKTtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIHZhciBzdWNjZXNzZnVsID0gZG9jdW1lbnQuZXhlY0NvbW1hbmQoJ2NvcHknKTtcclxuICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhbGxiYWNrOiBPb3BzLCB1bmFibGUgdG8gY29weScsIGVycik7XHJcbiAgICB9XHJcblxyXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZXh0QXJlYSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjb3B5VGV4dFRvQ2xpcGJvYXJkKHRleHQpIHtcclxuICAgIGlmICghbmF2aWdhdG9yLmNsaXBib2FyZCkge1xyXG4gICAgICAgIGZhbGxiYWNrQ29weVRleHRUb0NsaXBib2FyZCh0ZXh0KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh0ZXh0KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdBc3luYzogQ291bGQgbm90IGNvcHkgdGV4dDogJywgZXJyKTtcclxuICAgIH0pO1xyXG59XHJcbiJdfQ==