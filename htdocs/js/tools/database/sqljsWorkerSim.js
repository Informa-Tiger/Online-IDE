export class WorkerSim {
    constructor() {
        //@ts-ignore
        this.initsql = initSqlJs({ locateFile: (path, scriptDirectory) => "https://embed.learn-sql.de/include/lib/sql.js/sql-wasm.wasm" });
    }
    postMessageToClient(message) {
        this.onmessage({ data: message });
    }
    postMessage(data) {
        let that = this;
        if (that.db == null) {
            that.initsql.then((SQL1) => {
                that.SQL = SQL1;
                that.db = createDb(SQL1, undefined);
                that.worker(data);
            }).catch((err) => {
                console.log(err);
                //@ts-ignore
                return that.postMessageToClient({
                    id: this["data"]["id"],
                    error: err["message"]
                });
            });
        }
        else {
            that.worker(data);
        }
    }
    terminate() {
    }
    worker(data) {
        var buff;
        var result;
        var config = data["config"] ? data["config"] : {};
        try {
            switch (data && data["action"]) {
                case "open":
                    buff = data["buffer"];
                    this.db = createDb(this.SQL, buff && new Uint8Array(buff));
                    //@ts-ignore
                    return this.postMessageToClient({
                        id: data["id"],
                        ready: true
                    });
                case "exec":
                    if (this.db === null) {
                        this.db = createDb(this.SQL, undefined);
                    }
                    if (!data["sql"]) {
                        throw "exec: Missing query string";
                    }
                    //@ts-ignore
                    return this.postMessageToClient({
                        id: data["id"],
                        results: this.db.exec(data["sql"], data["params"], config)
                    });
                case "each":
                    if (this.db === null) {
                        this.db = createDb(this.SQL, undefined);
                    }
                    var callback = function callback(row) {
                        //@ts-ignore
                        return this.postMessage({
                            id: data["id"],
                            row: row,
                            finished: false
                        });
                    };
                    var done = function done() {
                        //@ts-ignore
                        return this.postMessage({
                            id: data["id"],
                            finished: true
                        });
                    };
                    return this.db.each(data["sql"], data["params"], callback, done, config);
                case "export":
                    buff = this.db["export"]();
                    result = {
                        id: data["id"],
                        results: [
                            {
                                buffer: buff
                            }
                        ]
                    };
                    try {
                        //@ts-ignore
                        return this.postMessageToClient(result);
                    }
                    catch (error) {
                        //@ts-ignore
                        return this.postMessageToClient(result);
                    }
                case "close":
                    if (this.db) {
                        this.db.close();
                    }
                    //@ts-ignore
                    return this.postMessageToClient({
                        id: data["id"]
                    });
                default:
                    throw new Error("Invalid action : " + (data && data["action"]));
            }
        }
        catch (err) {
            //@ts-ignore
            return this.postMessageToClient({
                id: data["id"],
                error: err["message"]
            });
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3FsanNXb3JrZXJTaW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2xpZW50L3Rvb2xzL2RhdGFiYXNlL3NxbGpzV29ya2VyU2ltLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxTQUFTO0lBQXRCO1FBRUksWUFBWTtRQUNaLFlBQU8sR0FBRyxTQUFTLENBQUMsRUFBQyxVQUFVLEVBQUUsQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQyw2REFBNkQsRUFBQyxDQUFDLENBQUM7SUEwSGhJLENBQUM7SUFsSEcsbUJBQW1CLENBQUMsT0FBWTtRQUM1QixJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUMsSUFBSSxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUE7SUFDbkMsQ0FBQztJQUVELFdBQVcsQ0FBQyxJQUFTO1FBQ2pCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLElBQUksQ0FBQyxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ3ZCLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDO2dCQUNoQixJQUFJLENBQUMsRUFBRSxHQUFHLFFBQVEsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDakIsWUFBWTtnQkFDWixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztvQkFDNUIsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQ3RCLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxD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QkFDTDtnQ0FDSSxNQUFNLEVBQUUsSUFBSTs2QkFDZjt5QkFDSjtxQkFDSixDQUFDO29CQUNGLElBQUk7d0JBQ0EsWUFBWTt3QkFDWixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztxQkFDM0M7b0JBQUMsT0FBTyxLQUFLLEVBQUU7d0JBQ1osWUFBWTt3QkFDWixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztxQkFDM0M7Z0JBQ0wsS0FBSyxPQUFPO29CQUNSLElBQUksSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDVCxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO3FCQUNuQjtvQkFDRCxZQUFZO29CQUNaLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixDQUFDO3dCQUM1QixFQUFFLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQztxQkFDakIsQ0FBQyxDQUFDO2dCQUNQO29CQUNJLE1BQU0sSUFBSSxLQUFLLENBQUMsbUJBQW1CLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUN2RTtTQUVKO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFFVixZQUFZO1lBQ1osT0FBTyxJQUFJLENBQUMsbUJBQW1CLENBQUM7Z0JBQzVCLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNkLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDO2FBQ3hCLENBQUMsQ0FBQztTQUNOO0lBRUwsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFdvcmtlclNpbSB7XHJcblxyXG4gICAgLy9AdHMtaWdub3JlXHJcbiAgICBpbml0c3FsID0gaW5pdFNxbEpzKHtsb2NhdGVGaWxlOiAocGF0aCwgc2NyaXB0RGlyZWN0b3J5KSA9PiBcImh0dHBzOi8vZW1iZWQubGVhcm4tc3FsLmRlL2luY2x1ZGUvbGliL3NxbC5qcy9zcWwtd2FzbS53YXNtXCJ9KTtcclxuICAgIGRiO1xyXG4gICAgU1FMO1xyXG5cclxuICAgIG9ubWVzc2FnZTogKGV2ZW50OiB7ZGF0YTogYW55fSkgPT4gdm9pZDtcclxuXHJcbiAgICBvbkVycm9yOiAoZXZlbnQ6IEVycm9yRXZlbnQpID0+IHZvaWQ7XHJcblxyXG4gICAgcG9zdE1lc3NhZ2VUb0NsaWVudChtZXNzYWdlOiBhbnkpIHtcclxuICAgICAgICB0aGlzLm9ubWVzc2FnZSh7ZGF0YTogbWVzc2FnZX0pXHJcbiAgICB9XHJcblxyXG4gICAgcG9zdE1lc3NhZ2UoZGF0YTogYW55KXtcclxuICAgICAgICBsZXQgdGhhdCA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoYXQuZGIgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGF0LmluaXRzcWwudGhlbigoU1FMMSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhhdC5TUUwgPSBTUUwxO1xyXG4gICAgICAgICAgICAgICAgdGhhdC5kYiA9IGNyZWF0ZURiKFNRTDEsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICB0aGF0LndvcmtlcihkYXRhKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoYXQucG9zdE1lc3NhZ2VUb0NsaWVudCh7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHRoaXNbXCJkYXRhXCJdW1wiaWRcIl0sXHJcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycltcIm1lc3NhZ2VcIl1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoYXQud29ya2VyKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0ZXJtaW5hdGUoKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHdvcmtlcihkYXRhOiBhbnkpIHtcclxuICAgICAgICB2YXIgYnVmZjsgdmFyIHJlc3VsdDtcclxuICAgICAgICB2YXIgY29uZmlnID0gZGF0YVtcImNvbmZpZ1wiXSA/IGRhdGFbXCJjb25maWdcIl0gOiB7fTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGRhdGEgJiYgZGF0YVtcImFjdGlvblwiXSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIm9wZW5cIjpcclxuICAgICAgICAgICAgICAgICAgICBidWZmID0gZGF0YVtcImJ1ZmZlclwiXTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRiID0gY3JlYXRlRGIodGhpcy5TUUwsIGJ1ZmYgJiYgbmV3IFVpbnQ4QXJyYXkoYnVmZikpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBvc3RNZXNzYWdlVG9DbGllbnQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZGF0YVtcImlkXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkeTogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImV4ZWNcIjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRiID0gY3JlYXRlRGIodGhpcy5TUUwsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0YVtcInNxbFwiXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBcImV4ZWM6IE1pc3NpbmcgcXVlcnkgc3RyaW5nXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBvc3RNZXNzYWdlVG9DbGllbnQoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZGF0YVtcImlkXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiB0aGlzLmRiLmV4ZWMoZGF0YVtcInNxbFwiXSwgZGF0YVtcInBhcmFtc1wiXSwgY29uZmlnKVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImVhY2hcIjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYiA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRiID0gY3JlYXRlRGIodGhpcy5TUUwsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uIGNhbGxiYWNrKHJvdykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRhdGFbXCJpZFwiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdzogcm93LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoZWQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRvbmUgPSBmdW5jdGlvbiBkb25lKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRhdGFbXCJpZFwiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmlzaGVkOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGIuZWFjaChkYXRhW1wic3FsXCJdLCBkYXRhW1wicGFyYW1zXCJdLCBjYWxsYmFjaywgZG9uZSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJleHBvcnRcIjpcclxuICAgICAgICAgICAgICAgICAgICBidWZmID0gdGhpcy5kYltcImV4cG9ydFwiXSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRhdGFbXCJpZFwiXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0czogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZmZlcjogYnVmZlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucG9zdE1lc3NhZ2VUb0NsaWVudChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wb3N0TWVzc2FnZVRvQ2xpZW50KHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FzZSBcImNsb3NlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYi5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wb3N0TWVzc2FnZVRvQ2xpZW50KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRhdGFbXCJpZFwiXVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGFjdGlvbiA6IFwiICsgKGRhdGEgJiYgZGF0YVtcImFjdGlvblwiXSkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xyXG5cclxuICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBvc3RNZXNzYWdlVG9DbGllbnQoe1xyXG4gICAgICAgICAgICAgICAgaWQ6IGRhdGFbXCJpZFwiXSxcclxuICAgICAgICAgICAgICAgIGVycm9yOiBlcnJbXCJtZXNzYWdlXCJdXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG5cclxufVxyXG5cclxuXHJcblxyXG5cclxuXHJcbiJdfQ==