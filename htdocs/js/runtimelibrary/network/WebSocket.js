import { Klass } from "../../compiler/types/Class.js";
import { intPrimitiveType, stringPrimitiveType, voidPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { Method, Parameterlist } from "../../compiler/types/Types.js";
import { InterpreterState } from "../../interpreter/Interpreter.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { WebSocketClientHelper } from "./WebSocketClient.js";
import { ajax } from "../../communication/AjaxHelper.js";
import { ArrayType } from "../../compiler/types/Array.js";
export class WebSocketClass extends Klass {
    constructor(module) {
        super("WebSocket", module, "Ein Objekt der Klasse WebSocket kann Daten über das Internet senden und empfangen. Um die Klasse benutzen zu können, musst Du eine eigene Klasse schreiben, die die Klasse WebSocket erweitert und die Methoden onConnect, onMessage, onOtherClientConnected und onOtherClientDisconnected überschreibt.");
        this.setBaseClass(module.typeStore.getType("Object"));
        let webSocketClientType = module.typeStore.getType("WebSocketClient");
        let systemClassType = module.typeStore.getType("System");
        this.addMethod(new Method("WebSocket", new Parameterlist([]), null, (parameters) => {
            var _a, _b;
            let o = parameters[0].value;
            let interpreter = (_b = (_a = this.module) === null || _a === void 0 ? void 0 : _a.main) === null || _b === void 0 ? void 0 : _b.getInterpreter();
            let wh = new WebSocketHelper(o, interpreter, webSocketClientType, systemClassType);
            o.intrinsicData["Helper"] = wh;
        }, false, false, 'Instanziert ein neues WebSocket-Objekt.', true));
        this.addMethod(new Method("open", new Parameterlist([
            { identifier: "sessionCode", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "nickName", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, (parameters) => {
            let o = parameters[0].value;
            let sessionCode = parameters[1].value;
            let nickName = parameters[2].value;
            let wh = o.intrinsicData["Helper"];
            wh.connect(sessionCode, nickName);
            o.intrinsicData["Helper"] = wh;
        }, false, false, 'Startet die Verbindung mit dem Server. Den SessionCode kannst Du frei wählen. Mit allen anderen Clients, die eine Verbindung mit demselben SessionCode aufbauen, kannst Du anschließend Daten austauschen. Auch der Nickname ist frei wählbar. Er ist für alle anderen Clients sichtbar.', false));
        this.addMethod(new Method("sendToAll", new Parameterlist([
            { identifier: "message", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "messageType", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let message = parameters[1].value;
            let messageType = parameters[2].value;
            wh.sendToAll(message, messageType);
        }, false, false, 'Sendet Daten (message) an alle anderen Clients. Den messageType kannst Du frei wählen. Die empfangenden Clients bekommen ihn zusammen mit den Daten übermittelt. Tipp: Du kannst auch Objekte senden, musst sie dazu aber vorher serialisieren, d.h. mithilfe der Methode toJson in eine Zeichenkette verwandeln.', false));
        this.addMethod(new Method("findClients", new Parameterlist([
            { identifier: "count", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let count = parameters[1].value;
            wh.findClientsFromCount(count);
        }, false, false, 'Sucht die übergebene Anzahl von "kontaktbereiten" Clients, d.h. solchen Clients, die exakt dieselbe Suchanfrage abgegeben haben. Findet der Server die Clients, so ruft er bei allen beteiligten Clients onClientsFound auf.', false));
        this.addMethod(new Method("findClients", new Parameterlist([
            { identifier: "nicknames", type: new ArrayType(stringPrimitiveType), declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let nickNamesValues = parameters[1].value;
            let nicknames = nickNamesValues.map((nnv) => nnv.value);
            wh.findClientsFromNicknames(nicknames);
        }, false, false, 'Sucht die Clients mit den angegebenen Nicknames. Haben sie eine entsprechende Suchanfrage (d.h. dieselben Nicknames) abgegeben, so so ruft der Server bei allen beteiligten Clients onClientsFound auf.', false));
        this.addMethod(new Method("findClient", new Parameterlist([
            { identifier: "nickname", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let nickName = parameters[1].value;
            wh.findClientsFromNicknames([nickName]);
        }, false, false, 'Sucht den Client mit dem angegebenen Nickname. Hat er eine entsprechende Suchanfrage (d.h. mit dem Nickname DIESES clients) abgegeben, so so ruft der Server bei beiden Clients onClientsFound auf.', false));
        this.addMethod(new Method("close", new Parameterlist([]), voidPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            wh.disconnect();
        }, false, false, 'Beendet die Verbindung. Bei allen anderen Clients, die sich mit derselben sessionId verbunden haben, wird daraufhin die Methode onOtherClientDisconnected aufgerufen.', false));
        this.addMethod(new Method("onOpen", new Parameterlist([]), null, null, // no statements!
        false, false, "Wird aufgerufen, sobald die Verbindung mit dem Server zustandegekommen ist.", false));
        this.addMethod(new Method("onClose", new Parameterlist([]), null, null, // no statements!
        false, false, "Wird aufgerufen, nachdem die Verbindung geschlossen wurde.", false));
        this.addMethod(new Method("onMessage", new Parameterlist([
            { identifier: "sender", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "message", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
            { identifier: "messageType", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true },
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn eine Nachricht eines anderen Clients empfangen wurde.", false));
        this.addMethod(new Method("onOtherClientConnected", new Parameterlist([
            { identifier: "otherClient", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn sich ein anderer Client unter Nutzung desselben sessionCodes mit dem Server verbunden hat.", false));
        this.addMethod(new Method("onOtherClientDisconnected", new Parameterlist([
            { identifier: "otherClient", type: webSocketClientType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird immer dann aufgerufen, wenn ein anderer Client unter Nutzung desselben sessionCodes die Verbindung mit dem Server beendet hat.", false));
        this.addMethod(new Method("onClientsFound", new Parameterlist([
            { identifier: "oherClients", type: new ArrayType(webSocketClientType), declaration: null, usagePositions: null, isFinal: true },
            { identifier: "ownNumber", type: intPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), null, null, // no statements!
        false, false, "Wird aufgerufen, wenn die durch die Methoden findClient bzw. findClients zuvor gesuchten Clients gefunden wurden.", false));
        this.addMethod(new Method("getOtherClients", new Parameterlist([]), new ArrayType(webSocketClientType), (parameters) => {
            let o = parameters[0].value;
            let wh = o.intrinsicData["Helper"];
            let ret = wh.clientList.map(client => { return { type: webSocketClientType, value: client.runtimeObject }; });
            return ret;
        }, // no statements!
        false, false, "Gibt alle bisher bei der selben Session angemeldeten Clients zurück.", false));
    }
}
export class WebSocketHelper {
    constructor(runtimeObject, interpreter, webSocketClientType, systemClassType) {
        this.runtimeObject = runtimeObject;
        this.interpreter = interpreter;
        this.webSocketClientType = webSocketClientType;
        this.systemClassType = systemClassType;
        this.clientList = [];
        this.idToClientMap = {};
        this.isOpen = false;
        this.unsentMessages = [];
        let klass = runtimeObject.class;
        // [[Entries]]:Array(4)
        // 0:{"Test3()" => Method}
        // 1:{"onConnect()" => Method}
        // 2:{"onMessage(WebSocketClient, String, String)" => Method}
        // 3:{"toJson()" => Method}
        this.onOpenMethod = klass.methods.find(m => m.signature == "onOpen()");
        this.onCloseMethod = klass.methods.find(m => m.signature == "onClose()");
        this.onMessageMethod = klass.methods.find(m => m.signature == "onMessage(WebSocketClient, String, String)");
        this.onClientConnectedMethod = klass.methods.find(m => m.signature == "onOtherClientConnected(WebSocketClient)");
        this.onClientDisconnectedMethod = klass.methods.find(m => m.signature == "onOtherClientDisconnected(WebSocketClient)");
        this.onClientsFoundMethod = klass.methods.find(m => m.signature == "onClientsFound(WebSocketClient[], int)");
    }
    connect(sessionCode, nickName) {
        if (this.interpreter.main.isEmbedded()) {
            this.interpreter.throwException("Die Netzwerkfunktionalitäten stehen nur eingeloggten Nutzern in der Entwicklungsumgebung zur Verfügung und können daher leider hier nicht ausprobiert werden.");
            return;
        }
        ajax('getWebSocketToken', {}, (response) => {
            let url = (window.location.protocol.startsWith("https") ? "wss://" : "ws://") + window.location.host + "/servlet/websocket";
            this.connection = new WebSocket(url);
            this.connection.onerror = (error) => { this.onError(error); };
            this.connection.onclose = (event) => { this.onClose(event); };
            this.connection.onmessage = (event) => { this.onMessage(event); };
            this.connection.onopen = (event) => {
                let request = {
                    command: 1,
                    token: response.token,
                    nickname: nickName,
                    sessionCode: sessionCode
                };
                this.interpreter.webSocketsToCloseAfterProgramHalt.push(this.connection);
                this.isOpen = true;
                this.sendIntern(JSON.stringify(request));
                this.onOpen();
            };
        });
    }
    sendIntern(message) {
        if (!this.isOpen) {
            this.unsentMessages.push(message);
        }
        else {
            try {
                this.connection.send(message);
            }
            catch (exception) {
                console.log(exception);
            }
        }
    }
    onClose(event) {
        this.isOpen = false;
        this.runMethod(this.onCloseMethod, []);
    }
    sendToClient(clientId, data, dataType) {
        let message = {
            command: 3,
            data: data,
            dataType: dataType,
            recipient_id: clientId
        };
        this.sendIntern(JSON.stringify(message));
    }
    sendToAll(data, dataType) {
        let message = {
            command: 2,
            data: data,
            dataType: dataType
        };
        this.sendIntern(JSON.stringify(message));
    }
    disconnect() {
        let message = {
            command: 4
        };
        this.sendIntern(JSON.stringify(message));
        this.connection.close();
        let wtr = this.interpreter.webSocketsToCloseAfterProgramHalt;
        wtr.splice(wtr.indexOf(this.connection), 1);
    }
    onMessage(event) {
        let response = JSON.parse(event.data);
        if (response.command == undefined)
            return;
        switch (response.command) {
            case 1: // new Client
                let clientRuntimeObject = new RuntimeObject(this.webSocketClientType);
                let wch = new WebSocketClientHelper(clientRuntimeObject, this, response.user_id, response.rufname, response.familienname, response.username, response.nickname);
                clientRuntimeObject.intrinsicData["Helper"] = wch;
                this.clientList.push(wch);
                this.idToClientMap[response.user_id] = wch;
                this.runMethod(this.onClientConnectedMethod, [{ type: this.webSocketClientType, value: clientRuntimeObject }]);
                break;
            case 2: // message
                let clientHelper = this.idToClientMap[response.from_client_id];
                if (clientHelper == null)
                    return;
                this.runMethod(this.onMessageMethod, [
                    { type: this.webSocketClientType, value: clientHelper.runtimeObject },
                    { type: stringPrimitiveType, value: response.data },
                    { type: stringPrimitiveType, value: response.dataType }
                ]);
                break;
            case 3: // other client disconnected
                let clientHelper1 = this.idToClientMap[response.disconnecting_client_id];
                if (clientHelper1 == null)
                    return;
                this.clientList.splice(this.clientList.indexOf(clientHelper1), 1);
                this.idToClientMap[response.disconnecting_client_id] = undefined;
                this.runMethod(this.onClientDisconnectedMethod, [
                    { type: this.webSocketClientType, value: clientHelper1.runtimeObject }
                ]);
                break;
            case 4: // time synchronization
                this.systemClassType.deltaTimeMillis = response.currentTimeMills - Date.now();
                this.client_id = response.client_id;
                break;
            case 5: // keep alive
                break;
            case 6: // Clients found
                this.onClientsFound(response);
                break;
        }
    }
    onClientsFound(response) {
        let own_index = 0;
        let otherClients = [];
        for (let client of response.clients) {
            if (client.id == this.client_id) {
                own_index = client.index;
            }
            else {
                let otherClient = this.idToClientMap[client.id];
                if (otherClient != null) {
                    otherClient.index = client.index;
                    otherClients.push({
                        type: this.webSocketClientType,
                        value: otherClient.runtimeObject
                    });
                }
            }
        }
        let arrayValue = {
            type: new ArrayType(this.webSocketClientType),
            value: otherClients
        };
        this.runMethod(this.onClientsFoundMethod, [arrayValue, { type: intPrimitiveType, value: own_index }]);
    }
    onError(error) {
        this.interpreter.throwException("Kommunikationsfehler beim WebSocket");
    }
    onOpen() {
        this.isOpen = true;
        if (this.unsentMessages.length > 0) {
            this.unsentMessages.forEach(m => this.sendIntern(m));
            this.unsentMessages = [];
        }
        this.runMethod(this.onOpenMethod, []);
    }
    runMethod(method, stackElements) {
        if (method == null)
            return;
        stackElements.splice(0, 0, {
            type: this.runtimeObject.class,
            value: this.runtimeObject
        });
        if (this.interpreter.state == InterpreterState.waitingForInput) {
            this.interpreter.executeImmediatelyInNewStackframe(method.program, stackElements);
        }
        else {
            this.interpreter.runTimer(method, stackElements, () => { }, false);
        }
    }
    findClientsFromCount(count) {
        let message = {
            command: 6,
            count: count,
            nicknames: []
        };
        this.sendIntern(JSON.stringify(message));
    }
    findClientsFromNicknames(nicknames) {
        let message = {
            command: 6,
            count: nicknames.length,
            nicknames: nicknames
        };
        this.sendIntern(JSON.stringify(message));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2ViU29ja2V0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9ydW50aW1lbGlicmFyeS9uZXR3b3JrL1dlYlNvY2tldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDdEQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDbEgsT0FBTyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQVMsTUFBTSwrQkFBK0IsQ0FBQztBQUM3RSxPQUFPLEVBQWUsZ0JBQWdCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNqRixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFbkUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDN0QsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBRXpELE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUUxRCxNQUFNLE9BQU8sY0FBZSxTQUFRLEtBQUs7SUFFckMsWUFBWSxNQUFjO1FBQ3RCLEtBQUssQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLDBTQUEwUyxDQUFDLENBQUM7UUFFdlUsSUFBSSxDQUFDLFlBQVksQ0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzdELElBQUksbUJBQW1CLEdBQVUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUM3RSxJQUFJLGVBQWUsR0FBZ0IsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFdEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxXQUFXLEVBQUUsSUFBSSxh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IFwiLi4vLi4vY29tcGlsZXIvcGFyc2VyL01vZHVsZS5qc1wiO1xyXG5pbXBvcnQgeyBLbGFzcyB9IGZyb20gXCIuLi8uLi9jb21waWxlci90eXBlcy9DbGFzcy5qc1wiO1xyXG5pbXBvcnQgeyBpbnRQcmltaXRpdmVUeXBlLCBzdHJpbmdQcmltaXRpdmVUeXBlLCB2b2lkUHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi8uLi9jb21waWxlci90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBNZXRob2QsIFBhcmFtZXRlcmxpc3QsIFZhbHVlIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL1R5cGVzLmpzXCI7XHJcbmltcG9ydCB7IEludGVycHJldGVyLCBJbnRlcnByZXRlclN0YXRlIH0gZnJvbSBcIi4uLy4uL2ludGVycHJldGVyL0ludGVycHJldGVyLmpzXCI7XHJcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBXZWJTb2NrZXRSZXF1ZXN0Q29ubmVjdCwgV2ViU29ja2V0UmVxdWVzdERpc2Nvbm5lY3QsIFdlYlNvY2tldFJlcXVlc3RTZW5kVG9BbGwsIFdlYlNvY2tldFJlcXVlc3RTZW5kVG9DbGllbnQsIFdlYlNvY2tldFJlc3BvbnNlT3RoZXJDbGllbnREaXNjb25uZWN0ZWQsIFdlYlNvY2tldFJlc3BvbnNlTWVzc2FnZSwgV2ViU29ja2V0UmVzcG9uc2VOZXdDbGllbnQsIFdlYlNvY2tldFJlc3BvbnNlLCBHZXRXZWJTb2NrZXRUb2tlblJlc3BvbnNlLCBXZWJTb2NrZXRSZXNwb25zZVBhaXJpbmdGb3VuZCwgV2ViU29ja2V0UmVxdWVzdEZpbmRQYWlyaW5nIH0gZnJvbSBcIi4uLy4uL2NvbW11bmljYXRpb24vRGF0YS5qc1wiO1xyXG5pbXBvcnQgeyBXZWJTb2NrZXRDbGllbnRIZWxwZXIgfSBmcm9tIFwiLi9XZWJTb2NrZXRDbGllbnQuanNcIjtcclxuaW1wb3J0IHsgYWpheCB9IGZyb20gXCIuLi8uLi9jb21tdW5pY2F0aW9uL0FqYXhIZWxwZXIuanNcIjtcclxuaW1wb3J0IHsgU3lzdGVtQ2xhc3MgfSBmcm9tIFwiLi4vU3lzdGVtLmpzXCI7XHJcbmltcG9ydCB7IEFycmF5VHlwZSB9IGZyb20gXCIuLi8uLi9jb21waWxlci90eXBlcy9BcnJheS5qc1wiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFdlYlNvY2tldENsYXNzIGV4dGVuZHMgS2xhc3Mge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZHVsZTogTW9kdWxlKSB7XHJcbiAgICAgICAgc3VwZXIoXCJXZWJTb2NrZXRcIiwgbW9kdWxlLCBcIkVpbiBPYmpla3QgZGVyIEtsYXNzZSBXZWJTb2NrZXQga2FubiBEYXRlbiDDvGJlciBkYXMgSW50ZXJuZXQgc2VuZGVuIHVuZCBlbXBmYW5nZW4uIFVtIGRpZSBLbGFzc2UgYmVudXR6ZW4genUga8O2bm5lbiwgbXVzc3QgRHUgZWluZSBlaWdlbmUgS2xhc3NlIHNjaHJlaWJlbiwgZGllIGRpZSBLbGFzc2UgV2ViU29ja2V0IGVyd2VpdGVydCB1bmQgZGllIE1ldGhvZGVuIG9uQ29ubmVjdCwgb25NZXNzYWdlLCBvbk90aGVyQ2xpZW50Q29ubmVjdGVkIHVuZCBvbk90aGVyQ2xpZW50RGlzY29ubmVjdGVkIMO8YmVyc2NocmVpYnQuXCIpO1xyXG5cclxuICAgICAgICB0aGlzLnNldEJhc2VDbGFzcyg8S2xhc3M+bW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiT2JqZWN0XCIpKTtcclxuICAgICAgICBsZXQgd2ViU29ja2V0Q2xpZW50VHlwZSA9IDxLbGFzcz5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJXZWJTb2NrZXRDbGllbnRcIik7XHJcbiAgICAgICAgbGV0IHN5c3RlbUNsYXNzVHlwZSA9IDxTeXN0ZW1DbGFzcz5tb2R1bGUudHlwZVN0b3JlLmdldFR5cGUoXCJTeXN0ZW1cIik7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJXZWJTb2NrZXRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgaW50ZXJwcmV0ZXIgPSB0aGlzLm1vZHVsZT8ubWFpbj8uZ2V0SW50ZXJwcmV0ZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgd2ggPSBuZXcgV2ViU29ja2V0SGVscGVyKG8sIGludGVycHJldGVyLCB3ZWJTb2NrZXRDbGllbnRUeXBlLCBzeXN0ZW1DbGFzc1R5cGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXSA9IHdoO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnSW5zdGFuemllcnQgZWluIG5ldWVzIFdlYlNvY2tldC1PYmpla3QuJywgdHJ1ZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib3BlblwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJzZXNzaW9uQ29kZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm5pY2tOYW1lXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBzZXNzaW9uQ29kZTogc3RyaW5nID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBuaWNrTmFtZTogc3RyaW5nID0gcGFyYW1ldGVyc1syXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuICAgICAgICAgICAgICAgIHdoLmNvbm5lY3Qoc2Vzc2lvbkNvZGUsIG5pY2tOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICBvLmludHJpbnNpY0RhdGFbXCJIZWxwZXJcIl0gPSB3aDtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1N0YXJ0ZXQgZGllIFZlcmJpbmR1bmcgbWl0IGRlbSBTZXJ2ZXIuIERlbiBTZXNzaW9uQ29kZSBrYW5uc3QgRHUgZnJlaSB3w6RobGVuLiBNaXQgYWxsZW4gYW5kZXJlbiBDbGllbnRzLCBkaWUgZWluZSBWZXJiaW5kdW5nIG1pdCBkZW1zZWxiZW4gU2Vzc2lvbkNvZGUgYXVmYmF1ZW4sIGthbm5zdCBEdSBhbnNjaGxpZcOfZW5kIERhdGVuIGF1c3RhdXNjaGVuLiBBdWNoIGRlciBOaWNrbmFtZSBpc3QgZnJlaSB3w6RobGJhci4gRXIgaXN0IGbDvHIgYWxsZSBhbmRlcmVuIENsaWVudHMgc2ljaHRiYXIuJyxcclxuICAgICAgICAgICAgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcInNlbmRUb0FsbFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJtZXNzYWdlXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibWVzc2FnZVR5cGVcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIHZvaWRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2U6IHN0cmluZyA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZVR5cGU6IHN0cmluZyA9IHBhcmFtZXRlcnNbMl0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgd2guc2VuZFRvQWxsKG1lc3NhZ2UsIG1lc3NhZ2VUeXBlKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1NlbmRldCBEYXRlbiAobWVzc2FnZSkgYW4gYWxsZSBhbmRlcmVuIENsaWVudHMuIERlbiBtZXNzYWdlVHlwZSBrYW5uc3QgRHUgZnJlaSB3w6RobGVuLiBEaWUgZW1wZmFuZ2VuZGVuIENsaWVudHMgYmVrb21tZW4gaWhuIHp1c2FtbWVuIG1pdCBkZW4gRGF0ZW4gw7xiZXJtaXR0ZWx0LiBUaXBwOiBEdSBrYW5uc3QgYXVjaCBPYmpla3RlIHNlbmRlbiwgbXVzc3Qgc2llIGRhenUgYWJlciB2b3JoZXIgc2VyaWFsaXNpZXJlbiwgZC5oLiBtaXRoaWxmZSBkZXIgTWV0aG9kZSB0b0pzb24gaW4gZWluZSBaZWljaGVua2V0dGUgdmVyd2FuZGVsbi4nLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZmluZENsaWVudHNcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwiY291bnRcIiwgdHlwZTogaW50UHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH0sXHJcbiAgICAgICAgXSksIHZvaWRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCB3aDogV2ViU29ja2V0SGVscGVyID0gby5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdO1xyXG4gICAgICAgICAgICAgICAgbGV0IGNvdW50OiBudW1iZXIgPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoLmZpbmRDbGllbnRzRnJvbUNvdW50KGNvdW50KTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ1N1Y2h0IGRpZSDDvGJlcmdlYmVuZSBBbnphaGwgdm9uIFwia29udGFrdGJlcmVpdGVuXCIgQ2xpZW50cywgZC5oLiBzb2xjaGVuIENsaWVudHMsIGRpZSBleGFrdCBkaWVzZWxiZSBTdWNoYW5mcmFnZSBhYmdlZ2ViZW4gaGFiZW4uIEZpbmRldCBkZXIgU2VydmVyIGRpZSBDbGllbnRzLCBzbyBydWZ0IGVyIGJlaSBhbGxlbiBiZXRlaWxpZ3RlbiBDbGllbnRzIG9uQ2xpZW50c0ZvdW5kIGF1Zi4nLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZmluZENsaWVudHNcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibmlja25hbWVzXCIsIHR5cGU6IG5ldyBBcnJheVR5cGUoc3RyaW5nUHJpbWl0aXZlVHlwZSksIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuICAgICAgICAgICAgICAgIGxldCBuaWNrTmFtZXNWYWx1ZXM6IFZhbHVlW10gPSBwYXJhbWV0ZXJzWzFdLnZhbHVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBuaWNrbmFtZXM6IHN0cmluZ1tdID0gbmlja05hbWVzVmFsdWVzLm1hcCgobm52KSA9PiBubnYudmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHdoLmZpbmRDbGllbnRzRnJvbU5pY2tuYW1lcyhuaWNrbmFtZXMpO1xyXG5cclxuICAgICAgICAgICAgfSwgZmFsc2UsIGZhbHNlLCAnU3VjaHQgZGllIENsaWVudHMgbWl0IGRlbiBhbmdlZ2ViZW5lbiBOaWNrbmFtZXMuIEhhYmVuIHNpZSBlaW5lIGVudHNwcmVjaGVuZGUgU3VjaGFuZnJhZ2UgKGQuaC4gZGllc2VsYmVuIE5pY2tuYW1lcykgYWJnZWdlYmVuLCBzbyBzbyBydWZ0IGRlciBTZXJ2ZXIgYmVpIGFsbGVuIGJldGVpbGlndGVuIENsaWVudHMgb25DbGllbnRzRm91bmQgYXVmLicsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJmaW5kQ2xpZW50XCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm5pY2tuYW1lXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuICAgICAgICAgICAgICAgIGxldCBuaWNrTmFtZTogc3RyaW5nID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aC5maW5kQ2xpZW50c0Zyb21OaWNrbmFtZXMoW25pY2tOYW1lXSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdTdWNodCBkZW4gQ2xpZW50IG1pdCBkZW0gYW5nZWdlYmVuZW4gTmlja25hbWUuIEhhdCBlciBlaW5lIGVudHNwcmVjaGVuZGUgU3VjaGFuZnJhZ2UgKGQuaC4gbWl0IGRlbSBOaWNrbmFtZSBESUVTRVMgY2xpZW50cykgYWJnZWdlYmVuLCBzbyBzbyBydWZ0IGRlciBTZXJ2ZXIgYmVpIGJlaWRlbiBDbGllbnRzIG9uQ2xpZW50c0ZvdW5kIGF1Zi4nLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiY2xvc2VcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgIF0pLCB2b2lkUHJpbWl0aXZlVHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aC5kaXNjb25uZWN0KCk7XHJcblxyXG4gICAgICAgICAgICB9LCBmYWxzZSwgZmFsc2UsICdCZWVuZGV0IGRpZSBWZXJiaW5kdW5nLiBCZWkgYWxsZW4gYW5kZXJlbiBDbGllbnRzLCBkaWUgc2ljaCBtaXQgZGVyc2VsYmVuIHNlc3Npb25JZCB2ZXJidW5kZW4gaGFiZW4sIHdpcmQgZGFyYXVmaGluIGRpZSBNZXRob2RlIG9uT3RoZXJDbGllbnREaXNjb25uZWN0ZWQgYXVmZ2VydWZlbi4nLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25PcGVuXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgYXVmZ2VydWZlbiwgc29iYWxkIGRpZSBWZXJiaW5kdW5nIG1pdCBkZW0gU2VydmVyIHp1c3RhbmRlZ2Vrb21tZW4gaXN0LlwiLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25DbG9zZVwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIG51bGwsIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJXaXJkIGF1ZmdlcnVmZW4sIG5hY2hkZW0gZGllIFZlcmJpbmR1bmcgZ2VzY2hsb3NzZW4gd3VyZGUuXCIsIGZhbHNlKSk7XHJcblxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJvbk1lc3NhZ2VcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwic2VuZGVyXCIsIHR5cGU6IHdlYlNvY2tldENsaWVudFR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwibWVzc2FnZVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm1lc3NhZ2VUeXBlXCIsIHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICBudWxsLCAvLyBubyBzdGF0ZW1lbnRzIVxyXG4gICAgICAgICAgICBmYWxzZSwgZmFsc2UsIFwiV2lyZCBpbW1lciBkYW5uIGF1ZmdlcnVmZW4sIHdlbm4gZWluZSBOYWNocmljaHQgZWluZXMgYW5kZXJlbiBDbGllbnRzIGVtcGZhbmdlbiB3dXJkZS5cIiwgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9uT3RoZXJDbGllbnRDb25uZWN0ZWRcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwib3RoZXJDbGllbnRcIiwgdHlwZTogd2ViU29ja2V0Q2xpZW50VHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgbnVsbCxcclxuICAgICAgICAgICAgbnVsbCwgLy8gbm8gc3RhdGVtZW50cyFcclxuICAgICAgICAgICAgZmFsc2UsIGZhbHNlLCBcIldpcmQgaW1tZXIgZGFubiBhdWZnZXJ1ZmVuLCB3ZW5uIHNpY2ggZWluIGFuZGVyZXIgQ2xpZW50IHVudGVyIE51dHp1bmcgZGVzc2VsYmVuIHNlc3Npb25Db2RlcyBtaXQgZGVtIFNlcnZlciB2ZXJidW5kZW4gaGF0LlwiLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwib25PdGhlckNsaWVudERpc2Nvbm5lY3RlZFwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJvdGhlckNsaWVudFwiLCB0eXBlOiB3ZWJTb2NrZXRDbGllbnRUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfVxyXG4gICAgICAgIF0pLCBudWxsLFxyXG4gICAgICAgICAgICBudWxsLCAvLyBubyBzdGF0ZW1lbnRzIVxyXG4gICAgICAgICAgICBmYWxzZSwgZmFsc2UsIFwiV2lyZCBpbW1lciBkYW5uIGF1ZmdlcnVmZW4sIHdlbm4gZWluIGFuZGVyZXIgQ2xpZW50IHVudGVyIE51dHp1bmcgZGVzc2VsYmVuIHNlc3Npb25Db2RlcyBkaWUgVmVyYmluZHVuZyBtaXQgZGVtIFNlcnZlciBiZWVuZGV0IGhhdC5cIiwgZmFsc2UpKTtcclxuXHJcbiAgICAgICAgdGhpcy5hZGRNZXRob2QobmV3IE1ldGhvZChcIm9uQ2xpZW50c0ZvdW5kXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtcclxuICAgICAgICAgICAgeyBpZGVudGlmaWVyOiBcIm9oZXJDbGllbnRzXCIsIHR5cGU6IG5ldyBBcnJheVR5cGUod2ViU29ja2V0Q2xpZW50VHlwZSksIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9LFxyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwib3duTnVtYmVyXCIsIHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIGRlY2xhcmF0aW9uOiBudWxsLCB1c2FnZVBvc2l0aW9uczogbnVsbCwgaXNGaW5hbDogdHJ1ZSB9XHJcbiAgICAgICAgXSksIG51bGwsXHJcbiAgICAgICAgICAgIG51bGwsIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJXaXJkIGF1ZmdlcnVmZW4sIHdlbm4gZGllIGR1cmNoIGRpZSBNZXRob2RlbiBmaW5kQ2xpZW50IGJ6dy4gZmluZENsaWVudHMgenV2b3IgZ2VzdWNodGVuIENsaWVudHMgZ2VmdW5kZW4gd3VyZGVuLlwiLCBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZ2V0T3RoZXJDbGllbnRzXCIsIG5ldyBQYXJhbWV0ZXJsaXN0KFtdKSxcclxuICAgICAgICAgICAgbmV3IEFycmF5VHlwZSh3ZWJTb2NrZXRDbGllbnRUeXBlKSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgd2g6IFdlYlNvY2tldEhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgcmV0ID0gd2guY2xpZW50TGlzdC5tYXAoY2xpZW50ID0+IHtyZXR1cm4ge3R5cGU6IHdlYlNvY2tldENsaWVudFR5cGUsIHZhbHVlOiBjbGllbnQucnVudGltZU9iamVjdH19KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcclxuXHJcbiAgICAgICAgICAgIH0sIC8vIG5vIHN0YXRlbWVudHMhXHJcbiAgICAgICAgICAgIGZhbHNlLCBmYWxzZSwgXCJHaWJ0IGFsbGUgYmlzaGVyIGJlaSBkZXIgc2VsYmVuIFNlc3Npb24gYW5nZW1lbGRldGVuIENsaWVudHMgenVyw7xjay5cIiwgZmFsc2UpKTtcclxuXHJcbiAgICB9XHJcblxyXG5cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFdlYlNvY2tldEhlbHBlciB7XHJcblxyXG4gICAgb25PcGVuTWV0aG9kOiBNZXRob2Q7XHJcbiAgICBvbkNsb3NlTWV0aG9kOiBNZXRob2Q7XHJcbiAgICBvbk1lc3NhZ2VNZXRob2Q6IE1ldGhvZDtcclxuICAgIG9uQ2xpZW50Q29ubmVjdGVkTWV0aG9kOiBNZXRob2Q7XHJcbiAgICBvbkNsaWVudERpc2Nvbm5lY3RlZE1ldGhvZDogTWV0aG9kO1xyXG4gICAgb25DbGllbnRzRm91bmRNZXRob2Q6IE1ldGhvZDtcclxuXHJcbiAgICBjbGllbnRMaXN0OiBXZWJTb2NrZXRDbGllbnRIZWxwZXJbXSA9IFtdO1xyXG4gICAgaWRUb0NsaWVudE1hcDogeyBbaWQ6IG51bWJlcl06IFdlYlNvY2tldENsaWVudEhlbHBlciB9ID0ge307XHJcblxyXG4gICAgY29ubmVjdGlvbjogV2ViU29ja2V0O1xyXG4gICAgY2xpZW50X2lkOiBudW1iZXI7IC8vIG93biBjbGllbnQtaWRcclxuICAgIGlzT3BlbjogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcnVudGltZU9iamVjdDogUnVudGltZU9iamVjdCwgcHJpdmF0ZSBpbnRlcnByZXRlcjogSW50ZXJwcmV0ZXIsXHJcbiAgICAgICAgcHJpdmF0ZSB3ZWJTb2NrZXRDbGllbnRUeXBlOiBLbGFzcywgcHJpdmF0ZSBzeXN0ZW1DbGFzc1R5cGU6IFN5c3RlbUNsYXNzKSB7XHJcblxyXG4gICAgICAgIGxldCBrbGFzczogS2xhc3MgPSA8S2xhc3M+cnVudGltZU9iamVjdC5jbGFzcztcclxuXHJcbiAgICAgICAgLy8gW1tFbnRyaWVzXV06QXJyYXkoNClcclxuICAgICAgICAvLyAwOntcIlRlc3QzKClcIiA9PiBNZXRob2R9XHJcbiAgICAgICAgLy8gMTp7XCJvbkNvbm5lY3QoKVwiID0+IE1ldGhvZH1cclxuICAgICAgICAvLyAyOntcIm9uTWVzc2FnZShXZWJTb2NrZXRDbGllbnQsIFN0cmluZywgU3RyaW5nKVwiID0+IE1ldGhvZH1cclxuICAgICAgICAvLyAzOntcInRvSnNvbigpXCIgPT4gTWV0aG9kfVxyXG5cclxuICAgICAgICB0aGlzLm9uT3Blbk1ldGhvZCA9IGtsYXNzLm1ldGhvZHMuZmluZChtID0+IG0uc2lnbmF0dXJlID09IFwib25PcGVuKClcIik7XHJcbiAgICAgICAgdGhpcy5vbkNsb3NlTWV0aG9kID0ga2xhc3MubWV0aG9kcy5maW5kKG0gPT4gbS5zaWduYXR1cmUgPT0gXCJvbkNsb3NlKClcIik7XHJcbiAgICAgICAgdGhpcy5vbk1lc3NhZ2VNZXRob2QgPSBrbGFzcy5tZXRob2RzLmZpbmQobSA9PiBtLnNpZ25hdHVyZSA9PSBcIm9uTWVzc2FnZShXZWJTb2NrZXRDbGllbnQsIFN0cmluZywgU3RyaW5nKVwiKTtcclxuICAgICAgICB0aGlzLm9uQ2xpZW50Q29ubmVjdGVkTWV0aG9kID0ga2xhc3MubWV0aG9kcy5maW5kKG0gPT4gbS5zaWduYXR1cmUgPT0gXCJvbk90aGVyQ2xpZW50Q29ubmVjdGVkKFdlYlNvY2tldENsaWVudClcIik7XHJcbiAgICAgICAgdGhpcy5vbkNsaWVudERpc2Nvbm5lY3RlZE1ldGhvZCA9IGtsYXNzLm1ldGhvZHMuZmluZChtID0+IG0uc2lnbmF0dXJlID09IFwib25PdGhlckNsaWVudERpc2Nvbm5lY3RlZChXZWJTb2NrZXRDbGllbnQpXCIpO1xyXG4gICAgICAgIHRoaXMub25DbGllbnRzRm91bmRNZXRob2QgPSBrbGFzcy5tZXRob2RzLmZpbmQobSA9PiBtLnNpZ25hdHVyZSA9PSBcIm9uQ2xpZW50c0ZvdW5kKFdlYlNvY2tldENsaWVudFtdLCBpbnQpXCIpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBjb25uZWN0KHNlc3Npb25Db2RlOiBzdHJpbmcsIG5pY2tOYW1lOiBzdHJpbmcpIHtcclxuXHJcbiAgICAgICAgaWYodGhpcy5pbnRlcnByZXRlci5tYWluLmlzRW1iZWRkZWQoKSl7XHJcbiAgICAgICAgICAgIHRoaXMuaW50ZXJwcmV0ZXIudGhyb3dFeGNlcHRpb24oXCJEaWUgTmV0endlcmtmdW5rdGlvbmFsaXTDpHRlbiBzdGVoZW4gbnVyIGVpbmdlbG9nZ3RlbiBOdXR6ZXJuIGluIGRlciBFbnR3aWNrbHVuZ3N1bWdlYnVuZyB6dXIgVmVyZsO8Z3VuZyB1bmQga8O2bm5lbiBkYWhlciBsZWlkZXIgaGllciBuaWNodCBhdXNwcm9iaWVydCB3ZXJkZW4uXCIpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgYWpheCgnZ2V0V2ViU29ja2V0VG9rZW4nLCB7fSwgKHJlc3BvbnNlOiBHZXRXZWJTb2NrZXRUb2tlblJlc3BvbnNlKSA9PiB7XHJcblxyXG4gICAgICAgICAgICBsZXQgdXJsOiBzdHJpbmcgPSAod2luZG93LmxvY2F0aW9uLnByb3RvY29sLnN0YXJ0c1dpdGgoXCJodHRwc1wiKSA/IFwid3NzOi8vXCIgOiBcIndzOi8vXCIpICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyBcIi9zZXJ2bGV0L3dlYnNvY2tldFwiO1xyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24gPSBuZXcgV2ViU29ja2V0KHVybCk7XHJcblxyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24ub25lcnJvciA9IChlcnJvcjogRXZlbnQpID0+IHsgdGhpcy5vbkVycm9yKGVycm9yKTsgfVxyXG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb24ub25jbG9zZSA9IChldmVudDogQ2xvc2VFdmVudCkgPT4geyB0aGlzLm9uQ2xvc2UoZXZlbnQpOyB9XHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbm1lc3NhZ2UgPSAoZXZlbnQ6IE1lc3NhZ2VFdmVudCkgPT4geyB0aGlzLm9uTWVzc2FnZShldmVudCk7IH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbi5vbm9wZW4gPSAoZXZlbnQ6IEV2ZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVxdWVzdDogV2ViU29ja2V0UmVxdWVzdENvbm5lY3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29tbWFuZDogMSxcclxuICAgICAgICAgICAgICAgICAgICB0b2tlbjogcmVzcG9uc2UudG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgbmlja25hbWU6IG5pY2tOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlc3Npb25Db2RlOiBzZXNzaW9uQ29kZVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJwcmV0ZXIud2ViU29ja2V0c1RvQ2xvc2VBZnRlclByb2dyYW1IYWx0LnB1c2godGhpcy5jb25uZWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNPcGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VuZEludGVybihKU09OLnN0cmluZ2lmeShyZXF1ZXN0KSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9uT3BlbigpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgdW5zZW50TWVzc2FnZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBzZW5kSW50ZXJuKG1lc3NhZ2U6IHN0cmluZykge1xyXG5cclxuICAgICAgICBpZiAoIXRoaXMuaXNPcGVuKSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5zZW50TWVzc2FnZXMucHVzaChtZXNzYWdlKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uLnNlbmQobWVzc2FnZSk7XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGV4Y2VwdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXhjZXB0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBvbkNsb3NlKGV2ZW50OiBDbG9zZUV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5pc09wZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnJ1bk1ldGhvZCh0aGlzLm9uQ2xvc2VNZXRob2QsIFtdKTtcclxuICAgIH1cclxuXHJcbiAgICBzZW5kVG9DbGllbnQoY2xpZW50SWQ6IG51bWJlciwgZGF0YTogc3RyaW5nLCBkYXRhVHlwZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2U6IFdlYlNvY2tldFJlcXVlc3RTZW5kVG9DbGllbnQgPSB7XHJcbiAgICAgICAgICAgIGNvbW1hbmQ6IDMsXHJcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgIGRhdGFUeXBlOiBkYXRhVHlwZSxcclxuICAgICAgICAgICAgcmVjaXBpZW50X2lkOiBjbGllbnRJZFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zZW5kSW50ZXJuKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcclxuICAgIH1cclxuXHJcbiAgICBzZW5kVG9BbGwoZGF0YTogc3RyaW5nLCBkYXRhVHlwZTogc3RyaW5nKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2U6IFdlYlNvY2tldFJlcXVlc3RTZW5kVG9BbGwgPSB7XHJcbiAgICAgICAgICAgIGNvbW1hbmQ6IDIsXHJcbiAgICAgICAgICAgIGRhdGE6IGRhdGEsXHJcbiAgICAgICAgICAgIGRhdGFUeXBlOiBkYXRhVHlwZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zZW5kSW50ZXJuKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcclxuICAgIH1cclxuXHJcbiAgICBkaXNjb25uZWN0KCkge1xyXG4gICAgICAgIGxldCBtZXNzYWdlOiBXZWJTb2NrZXRSZXF1ZXN0RGlzY29ubmVjdCA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogNFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zZW5kSW50ZXJuKEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpKTtcclxuICAgICAgICB0aGlzLmNvbm5lY3Rpb24uY2xvc2UoKTtcclxuICAgICAgICBsZXQgd3RyID0gdGhpcy5pbnRlcnByZXRlci53ZWJTb2NrZXRzVG9DbG9zZUFmdGVyUHJvZ3JhbUhhbHQ7XHJcbiAgICAgICAgd3RyLnNwbGljZSh3dHIuaW5kZXhPZih0aGlzLmNvbm5lY3Rpb24pLCAxKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk1lc3NhZ2UoZXZlbnQ6IE1lc3NhZ2VFdmVudCkge1xyXG5cclxuICAgICAgICBsZXQgcmVzcG9uc2U6IFdlYlNvY2tldFJlc3BvbnNlID0gSlNPTi5wYXJzZShldmVudC5kYXRhKTtcclxuICAgICAgICBpZiAocmVzcG9uc2UuY29tbWFuZCA9PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgc3dpdGNoIChyZXNwb25zZS5jb21tYW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMTogLy8gbmV3IENsaWVudFxyXG4gICAgICAgICAgICAgICAgbGV0IGNsaWVudFJ1bnRpbWVPYmplY3QgPSBuZXcgUnVudGltZU9iamVjdCh0aGlzLndlYlNvY2tldENsaWVudFR5cGUpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHdjaDogV2ViU29ja2V0Q2xpZW50SGVscGVyID0gbmV3IFdlYlNvY2tldENsaWVudEhlbHBlcihjbGllbnRSdW50aW1lT2JqZWN0LCB0aGlzLCByZXNwb25zZS51c2VyX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJ1Zm5hbWUsIHJlc3BvbnNlLmZhbWlsaWVubmFtZSwgcmVzcG9uc2UudXNlcm5hbWUsIHJlc3BvbnNlLm5pY2tuYW1lKTtcclxuICAgICAgICAgICAgICAgIGNsaWVudFJ1bnRpbWVPYmplY3QuaW50cmluc2ljRGF0YVtcIkhlbHBlclwiXSA9IHdjaDtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2xpZW50TGlzdC5wdXNoKHdjaCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlkVG9DbGllbnRNYXBbcmVzcG9uc2UudXNlcl9pZF0gPSB3Y2g7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ1bk1ldGhvZCh0aGlzLm9uQ2xpZW50Q29ubmVjdGVkTWV0aG9kLCBbeyB0eXBlOiB0aGlzLndlYlNvY2tldENsaWVudFR5cGUsIHZhbHVlOiBjbGllbnRSdW50aW1lT2JqZWN0IH1dKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIDI6IC8vIG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgIGxldCBjbGllbnRIZWxwZXIgPSB0aGlzLmlkVG9DbGllbnRNYXBbcmVzcG9uc2UuZnJvbV9jbGllbnRfaWRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNsaWVudEhlbHBlciA9PSBudWxsKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ1bk1ldGhvZCh0aGlzLm9uTWVzc2FnZU1ldGhvZCwgW1xyXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogdGhpcy53ZWJTb2NrZXRDbGllbnRUeXBlLCB2YWx1ZTogY2xpZW50SGVscGVyLnJ1bnRpbWVPYmplY3QgfSxcclxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6IHN0cmluZ1ByaW1pdGl2ZVR5cGUsIHZhbHVlOiByZXNwb25zZS5kYXRhIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCB2YWx1ZTogcmVzcG9uc2UuZGF0YVR5cGUgfVxyXG4gICAgICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAzOiAvLyBvdGhlciBjbGllbnQgZGlzY29ubmVjdGVkXHJcbiAgICAgICAgICAgICAgICBsZXQgY2xpZW50SGVscGVyMSA9IHRoaXMuaWRUb0NsaWVudE1hcFtyZXNwb25zZS5kaXNjb25uZWN0aW5nX2NsaWVudF9pZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoY2xpZW50SGVscGVyMSA9PSBudWxsKSByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudExpc3Quc3BsaWNlKHRoaXMuY2xpZW50TGlzdC5pbmRleE9mKGNsaWVudEhlbHBlcjEpLCAxKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaWRUb0NsaWVudE1hcFtyZXNwb25zZS5kaXNjb25uZWN0aW5nX2NsaWVudF9pZF0gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ1bk1ldGhvZCh0aGlzLm9uQ2xpZW50RGlzY29ubmVjdGVkTWV0aG9kLCBbXHJcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiB0aGlzLndlYlNvY2tldENsaWVudFR5cGUsIHZhbHVlOiBjbGllbnRIZWxwZXIxLnJ1bnRpbWVPYmplY3QgfVxyXG4gICAgICAgICAgICAgICAgXSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA0OiAvLyB0aW1lIHN5bmNocm9uaXphdGlvblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zeXN0ZW1DbGFzc1R5cGUuZGVsdGFUaW1lTWlsbGlzID0gcmVzcG9uc2UuY3VycmVudFRpbWVNaWxscyAtIERhdGUubm93KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNsaWVudF9pZCA9IHJlc3BvbnNlLmNsaWVudF9pZFxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgNTogLy8ga2VlcCBhbGl2ZVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgNjogLy8gQ2xpZW50cyBmb3VuZFxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbkNsaWVudHNGb3VuZChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgb25DbGllbnRzRm91bmQocmVzcG9uc2U6IFdlYlNvY2tldFJlc3BvbnNlUGFpcmluZ0ZvdW5kKSB7XHJcbiAgICAgICAgbGV0IG93bl9pbmRleDogbnVtYmVyID0gMDtcclxuICAgICAgICBsZXQgb3RoZXJDbGllbnRzOiBWYWx1ZVtdID0gW107XHJcblxyXG4gICAgICAgIGZvciAobGV0IGNsaWVudCBvZiByZXNwb25zZS5jbGllbnRzKSB7XHJcbiAgICAgICAgICAgIGlmIChjbGllbnQuaWQgPT0gdGhpcy5jbGllbnRfaWQpIHtcclxuICAgICAgICAgICAgICAgIG93bl9pbmRleCA9IGNsaWVudC5pbmRleDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCBvdGhlckNsaWVudCA9IHRoaXMuaWRUb0NsaWVudE1hcFtjbGllbnQuaWRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKG90aGVyQ2xpZW50ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBvdGhlckNsaWVudC5pbmRleCA9IGNsaWVudC5pbmRleDtcclxuICAgICAgICAgICAgICAgICAgICBvdGhlckNsaWVudHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG90aGVyQ2xpZW50LnJ1bnRpbWVPYmplY3RcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IGFycmF5VmFsdWU6IFZhbHVlID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBuZXcgQXJyYXlUeXBlKHRoaXMud2ViU29ja2V0Q2xpZW50VHlwZSksXHJcbiAgICAgICAgICAgIHZhbHVlOiBvdGhlckNsaWVudHNcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucnVuTWV0aG9kKHRoaXMub25DbGllbnRzRm91bmRNZXRob2QsIFthcnJheVZhbHVlLCB7IHR5cGU6IGludFByaW1pdGl2ZVR5cGUsIHZhbHVlOiBvd25faW5kZXggfV0pO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBvbkVycm9yKGVycm9yOiBFdmVudCkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJwcmV0ZXIudGhyb3dFeGNlcHRpb24oXCJLb21tdW5pa2F0aW9uc2ZlaGxlciBiZWltIFdlYlNvY2tldFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBvbk9wZW4oKSB7XHJcbiAgICAgICAgdGhpcy5pc09wZW4gPSB0cnVlO1xyXG4gICAgICAgIGlmKHRoaXMudW5zZW50TWVzc2FnZXMubGVuZ3RoID4gMCl7XHJcbiAgICAgICAgICAgIHRoaXMudW5zZW50TWVzc2FnZXMuZm9yRWFjaChtID0+IHRoaXMuc2VuZEludGVybihtKSk7XHJcbiAgICAgICAgICAgIHRoaXMudW5zZW50TWVzc2FnZXMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ydW5NZXRob2QodGhpcy5vbk9wZW5NZXRob2QsIFtdKTtcclxuICAgIH1cclxuXHJcbiAgICBydW5NZXRob2QobWV0aG9kOiBNZXRob2QsIHN0YWNrRWxlbWVudHM6IFZhbHVlW10pIHtcclxuICAgICAgICBpZiAobWV0aG9kID09IG51bGwpIHJldHVybjtcclxuICAgICAgICBzdGFja0VsZW1lbnRzLnNwbGljZSgwLCAwLCB7XHJcbiAgICAgICAgICAgIHR5cGU6IHRoaXMucnVudGltZU9iamVjdC5jbGFzcyxcclxuICAgICAgICAgICAgdmFsdWU6IHRoaXMucnVudGltZU9iamVjdFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5pbnRlcnByZXRlci5zdGF0ZSA9PSBJbnRlcnByZXRlclN0YXRlLndhaXRpbmdGb3JJbnB1dCkge1xyXG4gICAgICAgICAgICB0aGlzLmludGVycHJldGVyLmV4ZWN1dGVJbW1lZGlhdGVseUluTmV3U3RhY2tmcmFtZShtZXRob2QucHJvZ3JhbSwgc3RhY2tFbGVtZW50cyk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5pbnRlcnByZXRlci5ydW5UaW1lcihtZXRob2QsIHN0YWNrRWxlbWVudHMsICgpID0+IHsgfSwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmaW5kQ2xpZW50c0Zyb21Db3VudChjb3VudDogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2U6IFdlYlNvY2tldFJlcXVlc3RGaW5kUGFpcmluZyA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogNixcclxuICAgICAgICAgICAgY291bnQ6IGNvdW50LFxyXG4gICAgICAgICAgICBuaWNrbmFtZXM6IFtdXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGZpbmRDbGllbnRzRnJvbU5pY2tuYW1lcyhuaWNrbmFtZXM6IHN0cmluZ1tdKSB7XHJcbiAgICAgICAgbGV0IG1lc3NhZ2U6IFdlYlNvY2tldFJlcXVlc3RGaW5kUGFpcmluZyA9IHtcclxuICAgICAgICAgICAgY29tbWFuZDogNixcclxuICAgICAgICAgICAgY291bnQ6IG5pY2tuYW1lcy5sZW5ndGgsXHJcbiAgICAgICAgICAgIG5pY2tuYW1lczogbmlja25hbWVzXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnNlbmRJbnRlcm4oSlNPTi5zdHJpbmdpZnkobWVzc2FnZSkpO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=