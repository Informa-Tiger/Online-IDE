import { Klass } from "../../compiler/types/Class.js";
import { intPrimitiveType, stringPrimitiveType } from "../../compiler/types/PrimitiveTypes.js";
import { Method, Parameterlist } from "../../compiler/types/Types.js";
import { RuntimeObject } from "../../interpreter/RuntimeObject.js";
import { ResultsetHelper } from "./ResultSet.js";
export class DatabaseStatementClass extends Klass {
    constructor(module) {
        super("Statement", module, "Ein Statement-Objekt repräsentiert eine Anweisung an die Datenbank.");
        let resultSetType = module.typeStore.getType("ResultSet");
        this.setBaseClass(module.typeStore.getType("Object"));
        this.addMethod(new Method("executeQuery", new Parameterlist([
            { identifier: "query", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), resultSetType, (parameters) => {
            let o = parameters[0].value;
            let query = parameters[1].value;
            let connectionHelper = o.intrinsicData["ConnectionHelper"];
            let interpreter = module.main.getInterpreter();
            query = query.trim();
            if (!query.toLocaleLowerCase().startsWith("select")) {
                module.main.getInterpreter().resumeAfterInput(null);
                interpreter.throwException("Mit der Methode executeQuery können nur select-Anweisungen ausgeführt werden. Benutze für datenverändernde Anweisungen die Methode executeUpdate.");
                return null;
            }
            interpreter.pauseForInput();
            module.main.getBottomDiv().showHideDbBusyIcon(true);
            connectionHelper.executeQuery(query, (error, result) => {
                module.main.getBottomDiv().showHideDbBusyIcon(false);
                if (error != null) {
                    module.main.getInterpreter().resumeAfterInput(null);
                    interpreter.throwException(error);
                    return;
                }
                let rsh = new ResultsetHelper(result);
                let rs = new RuntimeObject(resultSetType);
                rs.intrinsicData["Helper"] = rsh;
                interpreter.resumeAfterInput({ value: rs, type: resultSetType }, true);
            });
        }, false, false, 'Führt ein SQL-Statement aus, das eine selct-Anweisung enthält.', false));
        this.addMethod(new Method("executeUpdate", new Parameterlist([
            { identifier: "query", type: stringPrimitiveType, declaration: null, usagePositions: null, isFinal: true }
        ]), intPrimitiveType, (parameters) => {
            let o = parameters[0].value;
            let query = parameters[1].value;
            let connectionHelper = o.intrinsicData["ConnectionHelper"];
            let interpreter = module.main.getInterpreter();
            query = query.trim();
            if (query.toLocaleLowerCase().startsWith("select")) {
                module.main.getInterpreter().resumeAfterInput(null);
                interpreter.throwException("Mit der Methode executeUpdate können nur datenverändernde Anweisungen ausgeführt werden. Benutze für select-Anweisungen die Methode executeQuery.");
                return;
            }
            interpreter.pauseForInput();
            module.main.getBottomDiv().showHideDbBusyIcon(true);
            connectionHelper.executeWriteStatement(query, (error) => {
                module.main.getBottomDiv().showHideDbBusyIcon(false);
                if (error != null) {
                    module.main.getInterpreter().resumeAfterInput(null);
                    interpreter.throwException(error);
                    return;
                }
                interpreter.resumeAfterInput({ value: 0, type: intPrimitiveType }, true);
            });
        }, false, false, 'Führt ein SQL-Statement aus, das eine datenverändernde Anweisung enthält.', false));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRGF0YWJhc2VTdGF0ZW1lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2xpZW50L3J1bnRpbWVsaWJyYXJ5L2RhdGFiYXNlL0RhdGFiYXNlU3RhdGVtZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQUMvRixPQUFPLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUVuRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFakQsTUFBTSxPQUFPLHNCQUF1QixTQUFRLEtBQUs7SUFFN0MsWUFBWSxNQUFjO1FBQ3RCLEtBQUssQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLHFFQUFxRSxDQUFDLENBQUM7UUFHbEcsSUFBSSxhQUFhLEdBQVUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFakUsSUFBSSxDQUFDLFlBQVksQ0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBRTdELElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxNQUFNLENBQUMsY0FBYyxFQUFFLElBQUksYUFBYSxDQUFDO1lBQ3hELEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUU7U0FDN0csQ0FBQyxFQUFFLGFBQWEsRUFDYixDQUFDLFVBQVUsRUFBRSxFQUFFO1lBRVgsSUFBSSxDQUFDLEdBQWtCLFVBQVUsQ0FB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LENBQUMsQ0FBQztnQkFDcEQsV0FBVyxDQUFDLGNBQWMsQ0FBQyxtSkFBbUosQ0FBQyxDQUFDO2dCQUNoTCxPQUFPO2FBQ1Y7WUFFRCxXQUFXLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDNUIsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVwRCxnQkFBZ0IsQ0FBQyxxQkFBcUIsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtnQkFDcEQsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDckQsSUFBRyxLQUFLLElBQUksSUFBSSxFQUFDO29CQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3BELFdBQVcsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ2xDLE9BQU87aUJBQ1Y7Z0JBQ0QsV0FBVyxDQUFDLGdCQUFnQixDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUMzRSxDQUFDLENBQUMsQ0FBQTtRQUVOLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLDJFQUEyRSxFQUM1RixLQUFLLENBQUMsQ0FBQyxDQUFDO0lBRWhCLENBQUM7Q0FFSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1vZHVsZSB9IGZyb20gXCIuLi8uLi9jb21waWxlci9wYXJzZXIvTW9kdWxlLmpzXCI7XHJcbmltcG9ydCB7IEtsYXNzIH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL0NsYXNzLmpzXCI7XHJcbmltcG9ydCB7IGludFByaW1pdGl2ZVR5cGUsIHN0cmluZ1ByaW1pdGl2ZVR5cGUgfSBmcm9tIFwiLi4vLi4vY29tcGlsZXIvdHlwZXMvUHJpbWl0aXZlVHlwZXMuanNcIjtcclxuaW1wb3J0IHsgTWV0aG9kLCBQYXJhbWV0ZXJsaXN0IH0gZnJvbSBcIi4uLy4uL2NvbXBpbGVyL3R5cGVzL1R5cGVzLmpzXCI7XHJcbmltcG9ydCB7IFJ1bnRpbWVPYmplY3QgfSBmcm9tIFwiLi4vLi4vaW50ZXJwcmV0ZXIvUnVudGltZU9iamVjdC5qc1wiO1xyXG5pbXBvcnQgeyBDb25uZWN0aW9uSGVscGVyIH0gZnJvbSBcIi4vQ29ubmVjdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBSZXN1bHRzZXRIZWxwZXIgfSBmcm9tIFwiLi9SZXN1bHRTZXQuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBEYXRhYmFzZVN0YXRlbWVudENsYXNzIGV4dGVuZHMgS2xhc3Mge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG1vZHVsZTogTW9kdWxlKSB7XHJcbiAgICAgICAgc3VwZXIoXCJTdGF0ZW1lbnRcIiwgbW9kdWxlLCBcIkVpbiBTdGF0ZW1lbnQtT2JqZWt0IHJlcHLDpHNlbnRpZXJ0IGVpbmUgQW53ZWlzdW5nIGFuIGRpZSBEYXRlbmJhbmsuXCIpO1xyXG5cclxuXHJcbiAgICAgICAgbGV0IHJlc3VsdFNldFR5cGUgPSA8S2xhc3M+bW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiUmVzdWx0U2V0XCIpO1xyXG5cclxuICAgICAgICB0aGlzLnNldEJhc2VDbGFzcyg8S2xhc3M+bW9kdWxlLnR5cGVTdG9yZS5nZXRUeXBlKFwiT2JqZWN0XCIpKTtcclxuIFxyXG4gICAgICAgIHRoaXMuYWRkTWV0aG9kKG5ldyBNZXRob2QoXCJleGVjdXRlUXVlcnlcIiwgbmV3IFBhcmFtZXRlcmxpc3QoW1xyXG4gICAgICAgICAgICB7IGlkZW50aWZpZXI6IFwicXVlcnlcIiwgdHlwZTogc3RyaW5nUHJpbWl0aXZlVHlwZSwgZGVjbGFyYXRpb246IG51bGwsIHVzYWdlUG9zaXRpb25zOiBudWxsLCBpc0ZpbmFsOiB0cnVlIH1cclxuICAgICAgICBdKSwgcmVzdWx0U2V0VHlwZSxcclxuICAgICAgICAgICAgKHBhcmFtZXRlcnMpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgbzogUnVudGltZU9iamVjdCA9IHBhcmFtZXRlcnNbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICBsZXQgcXVlcnk6IHN0cmluZyA9IHBhcmFtZXRlcnNbMV0udmFsdWU7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGNvbm5lY3Rpb25IZWxwZXI6IENvbm5lY3Rpb25IZWxwZXIgPSBvLmludHJpbnNpY0RhdGFbXCJDb25uZWN0aW9uSGVscGVyXCJdO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBpbnRlcnByZXRlciA9IG1vZHVsZS5tYWluLmdldEludGVycHJldGVyKCk7XHJcbiAgICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKTtcclxuICAgICAgICAgICAgICAgIGlmKCFxdWVyeS50b0xvY2FsZUxvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoXCJzZWxlY3RcIikpe1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5tYWluLmdldEludGVycHJldGVyKCkucmVzdW1lQWZ0ZXJJbnB1dChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcnByZXRlci50aHJvd0V4Y2VwdGlvbihcIk1pdCBkZXIgTWV0aG9kZSBleGVjdXRlUXVlcnkga8O2bm5lbiBudXIgc2VsZWN0LUFud2Vpc3VuZ2VuIGF1c2dlZsO8aHJ0IHdlcmRlbi4gQmVudXR6ZSBmw7xyIGRhdGVudmVyw6RuZGVybmRlIEFud2Vpc3VuZ2VuIGRpZSBNZXRob2RlIGV4ZWN1dGVVcGRhdGUuXCIpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaW50ZXJwcmV0ZXIucGF1c2VGb3JJbnB1dCgpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRCb3R0b21EaXYoKS5zaG93SGlkZURiQnVzeUljb24odHJ1ZSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25IZWxwZXIuZXhlY3V0ZVF1ZXJ5KHF1ZXJ5LCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0Qm90dG9tRGl2KCkuc2hvd0hpZGVEYkJ1c3lJY29uKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZihlcnJvciAhPSBudWxsKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5yZXN1bWVBZnRlcklucHV0KG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnByZXRlci50aHJvd0V4Y2VwdGlvbihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJzaCA9IG5ldyBSZXN1bHRzZXRIZWxwZXIocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcnMgPSBuZXcgUnVudGltZU9iamVjdChyZXN1bHRTZXRUeXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBycy5pbnRyaW5zaWNEYXRhW1wiSGVscGVyXCJdID0gcnNoO1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVycHJldGVyLnJlc3VtZUFmdGVySW5wdXQoe3ZhbHVlOiBycywgdHlwZTogcmVzdWx0U2V0VHlwZX0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ0bDvGhydCBlaW4gU1FMLVN0YXRlbWVudCBhdXMsIGRhcyBlaW5lIHNlbGN0LUFud2Vpc3VuZyBlbnRow6RsdC4nLFxyXG4gICAgICAgICAgICBmYWxzZSkpO1xyXG5cclxuICAgICAgICB0aGlzLmFkZE1ldGhvZChuZXcgTWV0aG9kKFwiZXhlY3V0ZVVwZGF0ZVwiLCBuZXcgUGFyYW1ldGVybGlzdChbXHJcbiAgICAgICAgICAgIHsgaWRlbnRpZmllcjogXCJxdWVyeVwiLCB0eXBlOiBzdHJpbmdQcmltaXRpdmVUeXBlLCBkZWNsYXJhdGlvbjogbnVsbCwgdXNhZ2VQb3NpdGlvbnM6IG51bGwsIGlzRmluYWw6IHRydWUgfVxyXG4gICAgICAgIF0pLCBpbnRQcmltaXRpdmVUeXBlLFxyXG4gICAgICAgICAgICAocGFyYW1ldGVycykgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBvOiBSdW50aW1lT2JqZWN0ID0gcGFyYW1ldGVyc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIGxldCBxdWVyeTogc3RyaW5nID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgY29ubmVjdGlvbkhlbHBlcjogQ29ubmVjdGlvbkhlbHBlciA9IG8uaW50cmluc2ljRGF0YVtcIkNvbm5lY3Rpb25IZWxwZXJcIl07XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGludGVycHJldGVyID0gbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKTtcclxuICAgICAgICAgICAgICAgIGlmKHF1ZXJ5LnRvTG9jYWxlTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChcInNlbGVjdFwiKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5yZXN1bWVBZnRlcklucHV0KG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGludGVycHJldGVyLnRocm93RXhjZXB0aW9uKFwiTWl0IGRlciBNZXRob2RlIGV4ZWN1dGVVcGRhdGUga8O2bm5lbiBudXIgZGF0ZW52ZXLDpG5kZXJuZGUgQW53ZWlzdW5nZW4gYXVzZ2Vmw7xocnQgd2VyZGVuLiBCZW51dHplIGbDvHIgc2VsZWN0LUFud2Vpc3VuZ2VuIGRpZSBNZXRob2RlIGV4ZWN1dGVRdWVyeS5cIik7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaW50ZXJwcmV0ZXIucGF1c2VGb3JJbnB1dCgpO1xyXG4gICAgICAgICAgICAgICAgbW9kdWxlLm1haW4uZ2V0Qm90dG9tRGl2KCkuc2hvd0hpZGVEYkJ1c3lJY29uKHRydWUpO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25IZWxwZXIuZXhlY3V0ZVdyaXRlU3RhdGVtZW50KHF1ZXJ5LCAoZXJyb3IpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRCb3R0b21EaXYoKS5zaG93SGlkZURiQnVzeUljb24oZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUubWFpbi5nZXRJbnRlcnByZXRlcigpLnJlc3VtZUFmdGVySW5wdXQobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGludGVycHJldGVyLnRocm93RXhjZXB0aW9uKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpbnRlcnByZXRlci5yZXN1bWVBZnRlcklucHV0KHt2YWx1ZTogMCwgdHlwZTogaW50UHJpbWl0aXZlVHlwZX0sIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIH0sIGZhbHNlLCBmYWxzZSwgJ0bDvGhydCBlaW4gU1FMLVN0YXRlbWVudCBhdXMsIGRhcyBlaW5lIGRhdGVudmVyw6RuZGVybmRlIEFud2Vpc3VuZyBlbnRow6RsdC4nLFxyXG4gICAgICAgICAgICBmYWxzZSkpO1xyXG5cclxuICAgIH1cclxuXHJcbn1cclxuXHJcblxyXG4iXX0=