import { stringPrimitiveType, charPrimitiveType, intPrimitiveType } from "../compiler/types/PrimitiveTypes.js";
export class InputManager {
    constructor($runDiv, main) {
        this.$runDiv = $runDiv;
        this.main = main;
    }
    readInput(method, parameters, callback) {
        let returnType = method.getReturnType();
        let message = parameters[1].value;
        let defaultValue = parameters.length == 3 ? parameters[2].value : null;
        let printManager = this.main.getInterpreter().printManager;
        if (message != null && message != "") {
            printManager.beginOfLineState = true;
            printManager.println("\n" + message);
            printManager.doPrinting();
        }
        this.$input = jQuery('<input class="jo_newInput" type="text"/>');
        let $od = printManager.$outputDiv;
        $od.append(this.$input);
        let dvt = defaultValue == null ? "" : defaultValue;
        this.$input.val(dvt);
        let that = this;
        // this.$runDiv.find('.jo_run-input-button').on('mousedown', (e)=>{
        //     e.preventDefault();
        //     that.onSubmit(returnType, callback);
        // });
        this.$input.on('keydown', (e) => {
            if (e.key == "Enter") {
                that.onSubmit(returnType, callback);
            }
        });
        setTimeout(() => {
            that.$input.focus();
        }, 200);
        printManager.$outputDiv.on('mousedown.inputmanager', (e) => {
            setTimeout(() => {
                var _a;
                (_a = that.$input) === null || _a === void 0 ? void 0 : _a.focus();
            }, 200);
        });
    }
    onSubmit(type, callback) {
        let v = (this.$input.val());
        let printManager = this.main.getInterpreter().printManager;
        let valueAndError = this.parse(v, type);
        if (valueAndError.error != null) {
            // jQuery('<div style="color: red">' + valueAndError.error + '</div>').insertBefore(this.$input);
            this.$input.detach();
            printManager.println(valueAndError.error, "#ff0000");
            printManager.doPrinting();
            printManager.$outputDiv.append(this.$input);
            this.$input[0].scrollIntoView();
            this.$input.focus();
            return;
        }
        printManager.$outputDiv.off('mousedown.inputmanager');
        printManager.println(v);
        this.$input.off('keydown');
        this.hide();
        callback(valueAndError.value);
    }
    parse(v, type) {
        if (type == stringPrimitiveType) {
            return {
                error: null,
                value: { value: v, type: type }
            };
        }
        if (type == charPrimitiveType) {
            if (v.length == 0)
                return { error: "Leere Eingabe. Erwartet wird ein Zeichen.", value: null };
            if (v.length > 1)
                return { error: "Zu lange Eingabe. Erwartet wird ein Zeichen.", value: null };
            return {
                error: null,
                value: { value: v, type: type }
            };
        }
        if (type == charPrimitiveType) {
            if (v != "true" && v != "false")
                return { error: "Erwartet wird true oder false.", value: null };
            return {
                error: null,
                value: { value: v == "true", type: type }
            };
        }
        v = v.replace(",", ".");
        let n = Number(v);
        if (n == null) {
            return { error: "Erwartet wird eine Zahl.", value: null };
        }
        if (type == intPrimitiveType) {
            if (n != Math.round(n))
                return { error: "Erwartet wird eine ganze Zahl.", value: null };
            return {
                error: null,
                value: { value: Math.round(n), type: type }
            };
        }
        return {
            error: null,
            value: { value: n, type: type }
        };
    }
    hide() {
        if (this.$input != null) {
            this.$input.remove();
            this.$input = null;
        }
        // this.$runDiv.find('.jo_run-input').css('display', 'none');
        // this.$runDiv.find('.jo_run-input-button').off('mousedown');
        // this.$runDiv.find('.jo_run-input-input').off('keydown');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5wdXRNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NsaWVudC9pbnRlcnByZXRlci9JbnB1dE1hbmFnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGlCQUFpQixFQUFFLGdCQUFnQixFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFJL0csTUFBTSxPQUFPLFlBQVk7SUFJckIsWUFBb0IsT0FBNEIsRUFBVSxJQUFjO1FBQXBELFlBQU8sR0FBUCxPQUFPLENBQXFCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBVTtJQUV4RSxDQUFDO0lBRU0sU0FBUyxDQUFDLE1BQWMsRUFBRSxVQUFtQixFQUFFLFFBQWdDO1FBRWxGLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUN4QyxJQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2xDLElBQUksWUFBWSxHQUFHLFVBQVUsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFFdkUsSUFBSSxZQUFZLEdBQWlCLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUMsWUFBWSxDQUFDO1FBQ3pFLElBQUcsT0FBTyxJQUFJLElBQUksSUFBSSxPQUFPLElBQUksRUFBRSxFQUFDO1lBQ2hDLFlBQVksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7WUFDckMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUM7WUFDckMsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDO1NBQzdCO1FBRUQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsMENBQTBDLENBQUMsQ0FBQztRQUVqRSxJQUFJLEdBQUcsR0FBRyxZQUFZ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O1lBQ3JGLE9BQU87Z0JBQ0gsS0FBSyxFQUFFLElBQUk7Z0JBQ1gsS0FBSyxFQUFFLEVBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQzthQUM1QyxDQUFBO1NBQ0o7UUFFRCxPQUFPO1lBQ0gsS0FBSyxFQUFFLElBQUk7WUFDWCxLQUFLLEVBQUUsRUFBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUM7U0FDaEMsQ0FBQTtJQUVMLENBQUM7SUFHRCxJQUFJO1FBRUEsSUFBRyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksRUFBQztZQUNuQixJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3JCLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ3RCO1FBRUQsNkRBQTZEO1FBRTdELDhEQUE4RDtRQUU5RCwyREFBMkQ7SUFFL0QsQ0FBQztDQUdKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHlwZSwgTWV0aG9kLCBWYWx1ZSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9UeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBzdHJpbmdQcmltaXRpdmVUeXBlLCBjaGFyUHJpbWl0aXZlVHlwZSwgaW50UHJpbWl0aXZlVHlwZSB9IGZyb20gXCIuLi9jb21waWxlci90eXBlcy9QcmltaXRpdmVUeXBlcy5qc1wiO1xyXG5pbXBvcnQgeyBNYWluQmFzZSB9IGZyb20gXCIuLi9tYWluL01haW5CYXNlLmpzXCI7XHJcbmltcG9ydCB7IFByaW50TWFuYWdlciB9IGZyb20gXCIuLi9tYWluL2d1aS9QcmludE1hbmFnZXIuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBJbnB1dE1hbmFnZXIge1xyXG5cclxuICAgICRpbnB1dDogSlF1ZXJ5PEhUTUxJbnB1dEVsZW1lbnQ+O1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgJHJ1bkRpdjogSlF1ZXJ5PEhUTUxFbGVtZW50PiwgcHJpdmF0ZSBtYWluOiBNYWluQmFzZSl7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZWFkSW5wdXQobWV0aG9kOiBNZXRob2QsIHBhcmFtZXRlcnM6IFZhbHVlW10sIGNhbGxiYWNrOiAodmFsdWU6IFZhbHVlKSA9PiB2b2lkKXtcclxuXHJcbiAgICAgICAgbGV0IHJldHVyblR5cGUgPSBtZXRob2QuZ2V0UmV0dXJuVHlwZSgpO1xyXG4gICAgICAgIGxldCBtZXNzYWdlID0gcGFyYW1ldGVyc1sxXS52YWx1ZTtcclxuICAgICAgICBsZXQgZGVmYXVsdFZhbHVlID0gcGFyYW1ldGVycy5sZW5ndGggPT0gMyA/IHBhcmFtZXRlcnNbMl0udmFsdWUgOiBudWxsO1xyXG5cclxuICAgICAgICBsZXQgcHJpbnRNYW5hZ2VyOiBQcmludE1hbmFnZXIgPSB0aGlzLm1haW4uZ2V0SW50ZXJwcmV0ZXIoKS5wcmludE1hbmFnZXI7XHJcbiAgICAgICAgaWYobWVzc2FnZSAhPSBudWxsICYmIG1lc3NhZ2UgIT0gXCJcIil7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci5iZWdpbk9mTGluZVN0YXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgcHJpbnRNYW5hZ2VyLnByaW50bG4oXCJcXG5cIiArIG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICBwcmludE1hbmFnZXIuZG9QcmludGluZygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy4kaW5wdXQgPSBqUXVlcnkoJzxpbnB1dCBjbGFzcz1cImpvX25ld0lucHV0XCIgdHlwZT1cInRleHRcIi8+Jyk7XHJcblxyXG4gICAgICAgIGxldCAkb2QgPSBwcmludE1hbmFnZXIuJG91dHB1dERpdjtcclxuICAgICAgICAkb2QuYXBwZW5kKHRoaXMuJGlucHV0KTtcclxuXHJcbiAgICAgICAgbGV0IGR2dCA9IGRlZmF1bHRWYWx1ZSA9PSBudWxsID8gXCJcIiA6IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB0aGlzLiRpbnB1dC52YWwoZHZ0KTtcclxuXHJcbiAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG5cclxuICAgICAgICAvLyB0aGlzLiRydW5EaXYuZmluZCgnLmpvX3J1bi1pbnB1dC1idXR0b24nKS5vbignbW91c2Vkb3duJywgKGUpPT57XHJcbiAgICAgICAgLy8gICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAvLyAgICAgdGhhdC5vblN1Ym1pdChyZXR1cm5UeXBlLCBjYWxsYmFjayk7XHJcbiAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdGhpcy4kaW5wdXQub24oJ2tleWRvd24nLCAoZSkgPT4ge1xyXG4gICAgICAgICAgICBpZihlLmtleSA9PSBcIkVudGVyXCIpe1xyXG4gICAgICAgICAgICAgICAgdGhhdC5vblN1Ym1pdChyZXR1cm5UeXBlLCBjYWxsYmFjayk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhhdC4kaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICB9LCAyMDApO1xyXG5cclxuICAgICAgICBwcmludE1hbmFnZXIuJG91dHB1dERpdi5vbignbW91c2Vkb3duLmlucHV0bWFuYWdlcicsIChlKSA9PiB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhhdC4kaW5wdXQ/LmZvY3VzKCk7XHJcbiAgICAgICAgICAgIH0sIDIwMCk7XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICB9XHJcblxyXG4gICAgb25TdWJtaXQodHlwZTogVHlwZSwgY2FsbGJhY2s6ICh2YWx1ZTogVmFsdWUpID0+IHZvaWQpe1xyXG4gICAgICAgIGxldCB2OiBzdHJpbmcgPSA8c3RyaW5nPih0aGlzLiRpbnB1dC52YWwoKSk7XHJcbiAgICAgICAgbGV0IHByaW50TWFuYWdlciA9IHRoaXMubWFpbi5nZXRJbnRlcnByZXRlcigpLnByaW50TWFuYWdlcjtcclxuXHJcbiAgICAgICAgbGV0IHZhbHVlQW5kRXJyb3IgPSB0aGlzLnBhcnNlKHYsIHR5cGUpO1xyXG5cclxuICAgICAgICBpZih2YWx1ZUFuZEVycm9yLmVycm9yICE9IG51bGwpe1xyXG4gICAgICAgICAgICAvLyBqUXVlcnkoJzxkaXYgc3R5bGU9XCJjb2xvcjogcmVkXCI+JyArIHZhbHVlQW5kRXJyb3IuZXJyb3IgKyAnPC9kaXY+JykuaW5zZXJ0QmVmb3JlKHRoaXMuJGlucHV0KTtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQuZGV0YWNoKCk7XHJcbiAgICAgICAgICAgIHByaW50TWFuYWdlci5wcmludGxuKHZhbHVlQW5kRXJyb3IuZXJyb3IsIFwiI2ZmMDAwMFwiKTtcclxuICAgICAgICAgICAgcHJpbnRNYW5hZ2VyLmRvUHJpbnRpbmcoKTtcclxuICAgICAgICAgICAgcHJpbnRNYW5hZ2VyLiRvdXRwdXREaXYuYXBwZW5kKHRoaXMuJGlucHV0KTtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXRbMF0uc2Nyb2xsSW50b1ZpZXcoKTtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQuZm9jdXMoKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBwcmludE1hbmFnZXIuJG91dHB1dERpdi5vZmYoJ21vdXNlZG93bi5pbnB1dG1hbmFnZXInKTtcclxuICAgICAgICBwcmludE1hbmFnZXIucHJpbnRsbih2KTtcclxuICAgICAgICB0aGlzLiRpbnB1dC5vZmYoJ2tleWRvd24nKTtcclxuICAgICAgICB0aGlzLmhpZGUoKTtcclxuXHJcbiAgICAgICAgY2FsbGJhY2sodmFsdWVBbmRFcnJvci52YWx1ZSk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHBhcnNlKHY6IHN0cmluZywgdHlwZTogVHlwZSk6e3ZhbHVlOiBWYWx1ZSwgZXJyb3I6IHN0cmluZ30ge1xyXG5cclxuICAgICAgICBpZih0eXBlID09IHN0cmluZ1ByaW1pdGl2ZVR5cGUpe1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge3ZhbHVlOiB2LCB0eXBlOiB0eXBlfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZih0eXBlID09IGNoYXJQcmltaXRpdmVUeXBlKXtcclxuICAgICAgICAgICAgaWYodi5sZW5ndGggPT0gMCkgcmV0dXJuIHtlcnJvcjogXCJMZWVyZSBFaW5nYWJlLiBFcndhcnRldCB3aXJkIGVpbiBaZWljaGVuLlwiLCB2YWx1ZTogbnVsbH07XHJcbiAgICAgICAgICAgIGlmKHYubGVuZ3RoID4gMSkgcmV0dXJuIHtlcnJvcjogXCJadSBsYW5nZSBFaW5nYWJlLiBFcndhcnRldCB3aXJkIGVpbiBaZWljaGVuLlwiLCB2YWx1ZTogbnVsbH07XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB7dmFsdWU6IHYsIHR5cGU6IHR5cGV9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHR5cGUgPT0gY2hhclByaW1pdGl2ZVR5cGUpe1xyXG4gICAgICAgICAgICBpZih2ICE9IFwidHJ1ZVwiICYmIHYgIT0gXCJmYWxzZVwiKSByZXR1cm4ge2Vycm9yOiBcIkVyd2FydGV0IHdpcmQgdHJ1ZSBvZGVyIGZhbHNlLlwiLCB2YWx1ZTogbnVsbH07XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgICAgICAgICAgIHZhbHVlOiB7dmFsdWU6IHYgPT0gXCJ0cnVlXCIsIHR5cGU6IHR5cGV9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHYgPSB2LnJlcGxhY2UoXCIsXCIsIFwiLlwiKTtcclxuXHJcbiAgICAgICAgbGV0IG4gPSBOdW1iZXIodik7XHJcblxyXG4gICAgICAgIGlmKG4gPT0gbnVsbCl7XHJcbiAgICAgICAgICAgIHJldHVybiB7ZXJyb3I6IFwiRXJ3YXJ0ZXQgd2lyZCBlaW5lIFphaGwuXCIsIHZhbHVlOiBudWxsfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHR5cGUgPT0gaW50UHJpbWl0aXZlVHlwZSl7XHJcbiAgICAgICAgICAgIGlmKG4gIT0gTWF0aC5yb3VuZChuKSkgcmV0dXJuIHtlcnJvcjogXCJFcndhcnRldCB3aXJkIGVpbmUgZ2FuemUgWmFobC5cIiwgdmFsdWU6IG51bGx9O1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgZXJyb3I6IG51bGwsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge3ZhbHVlOiBNYXRoLnJvdW5kKG4pLCB0eXBlOiB0eXBlfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBlcnJvcjogbnVsbCxcclxuICAgICAgICAgICAgdmFsdWU6IHt2YWx1ZTogbiwgdHlwZTogdHlwZX1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBoaWRlKCl7XHJcblxyXG4gICAgICAgIGlmKHRoaXMuJGlucHV0ICE9IG51bGwpe1xyXG4gICAgICAgICAgICB0aGlzLiRpbnB1dC5yZW1vdmUoKTtcclxuICAgICAgICAgICAgdGhpcy4kaW5wdXQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gdGhpcy4kcnVuRGl2LmZpbmQoJy5qb19ydW4taW5wdXQnKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xyXG5cclxuICAgICAgICAvLyB0aGlzLiRydW5EaXYuZmluZCgnLmpvX3J1bi1pbnB1dC1idXR0b24nKS5vZmYoJ21vdXNlZG93bicpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIHRoaXMuJHJ1bkRpdi5maW5kKCcuam9fcnVuLWlucHV0LWlucHV0Jykub2ZmKCdrZXlkb3duJyk7XHJcblxyXG4gICAgfVxyXG5cclxuXHJcbn0iXX0=